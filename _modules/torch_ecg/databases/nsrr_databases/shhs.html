
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>torch_ecg.databases.nsrr_databases.shhs &#8212; torch-ecg 0.0.31 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css?v=97348ffd" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css?v=97348ffd" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../../_static/documentation_options.js?v=c5dbc6bb"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/torch_ecg/databases/nsrr_databases/shhs';</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../_static/deep-psp-logo.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../../../../_static/deep-psp-logo.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">torch-ecg</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../install.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../tutorial.html">
    Tutorial
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../api/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../CHANGELOG.html">
    Changelog
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DeepPSP/torch_ecg" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../install.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../tutorial.html">
    Tutorial
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../api/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../CHANGELOG.html">
    Changelog
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DeepPSP/torch_ecg" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">torch_ecg.da...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for torch_ecg.databases.nsrr_databases.shhs</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numbers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Real</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">SS</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xmltodict</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xtd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm.auto</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">...cfg</span><span class="w"> </span><span class="kn">import</span> <span class="n">DEFAULTS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">...utils.misc</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_docstring</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">...utils.utils_interval</span><span class="w"> </span><span class="kn">import</span> <span class="n">intervals_union</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..base</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataBaseInfo</span><span class="p">,</span> <span class="n">NSRRDataBase</span><span class="p">,</span> <span class="n">PSGDataBaseMixin</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;SHHS&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">_SHHS_INFO</span> <span class="o">=</span> <span class="n">DataBaseInfo</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Sleep Heart Health Study</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">about</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    **ABOUT the dataset** (Main webpage [1]_):</span>

<span class="s2">    1. shhs1 (Visit 1):</span>

<span class="s2">        - the baseline clinic visit and polysomnogram performed between November 1, 1995 and January 31, 1998</span>
<span class="s2">        - in all, 6,441 men and women aged 40 years and older were enrolled</span>
<span class="s2">        - 5,804 rows, down from the original 6,441 due to data sharing rules on certain cohorts and subjects</span>

<span class="s2">    2. shhs-interim-followup (Interim Follow-up):</span>

<span class="s2">        - an interim clinic visit or phone call 2-3 years after baseline (shhs1)</span>
<span class="s2">        - 5,804 rows, despite some subjects not having complete data, all original subjects are present in the dataset</span>

<span class="s2">    3. shhs2 (Visit 2):</span>

<span class="s2">        - the follow-up clinic visit and polysomnogram performed between January 2001 and June 2003</span>
<span class="s2">        - during this exam cycle 3, a second polysomnogram was obtained in 3,295 of the participants</span>
<span class="s2">        - 4,080 rows, not all cohorts and subjects took part</span>

<span class="s2">    4. shhs-cvd (CVD Outcomes):</span>

<span class="s2">        - the tracking of adjudicated heart health outcomes (e.g. stroke, heart attack) between baseline (shhs1) and 2008-2011 (varies by parent cohort)</span>
<span class="s2">        - 5,802 rows, outcomes data were not provided on all subjects</span>

<span class="s2">    5. shhs-cvd-events (CVD Outcome Events):</span>

<span class="s2">        - event-level details for the tracking of heart health outcomes (shhs-cvd)</span>
<span class="s2">        - 4,839 rows, representing individual events</span>

<span class="s2">    6. ECG was sampled at 125 Hz in shhs1 and 250/256 Hz in shhs2</span>
<span class="s2">    7. `annotations-events-nsrr` and `annotations-events-profusion`:</span>
<span class="s2">       annotation files both contain xml files, the former processed in the EDF Editor and Translator tool,</span>
<span class="s2">       the latter exported from Compumedics Profusion</span>
<span class="s2">    8. about 10</span><span class="si">% o</span><span class="s2">f the records have HRV (including sleep stages and sleep events) annotations</span>

<span class="s2">    **DATA Analysis Tips**:</span>

<span class="s2">    1. Respiratory Disturbance Index (RDI):</span>

<span class="s2">        - A number of RDI variables exist in the data set. These variables are highly skewed.</span>
<span class="s2">        - log-transformation is recommended, among which the following transformation performed best, at least in some subsets:</span>

<span class="s2">          .. math::</span>

<span class="s2">            NEWVA = \log(OLDVAR + 0.1)</span>

<span class="s2">    2. Obstructive Apnea Index (OAI):</span>

<span class="s2">        - There is one OAI index in the data set. It reflects obstructive events associated with a 4</span><span class="si">% d</span><span class="s2">esaturation or arousal. Nearly 30</span><span class="si">% o</span><span class="s2">f the cohort has a zero value for this variable</span>
<span class="s2">        - Dichotomization is suggested (e.g. &gt;=3 or &gt;=4 events per hour indicates positive)</span>

<span class="s2">    3. Central Apnea Index (CAI):</span>

<span class="s2">        - Several variables describe central breathing events, with different thresholds for desaturation and requirement/non-requirement of arousals. ~58</span><span class="si">% o</span><span class="s2">f the cohort have zero values</span>
<span class="s2">        - Dichotomization is suggested (e.g. &gt;=3 or &gt;=4 events per hour indicates positive)</span>

<span class="s2">    4. Sleep Stages:</span>

<span class="s2">        - Stage 1 and stage 3-4 are not normally distributed, but stage 2 and REM sleep are.</span>
<span class="s2">        - To use these data as continuous dependent variables, stages 1 and 3-4 must be transformed. The following formula is suggested:</span>

<span class="s2">          .. math::</span>

<span class="s2">            –\log(-\log(val/100+0.001))</span>

<span class="s2">    5. Sleep time below 90% O2:</span>

<span class="s2">        - Percent of total sleep time with oxygen levels below 75%, 80%, 85</span><span class="si">% a</span><span class="s2">nd 90% were recorded</span>
<span class="s2">        - Dichotomization is suggested (e.g. &gt;5</span><span class="si">% a</span><span class="s2">nd &gt;10</span><span class="si">% o</span><span class="s2">f sleep time with oxygen levels below a specific O2 level indicates positive)</span>

<span class="s2">    **ABOUT signals**: (ref. [9]_)</span>

<span class="s2">    1. C3/A2 and C4/A1 EEGs, sampled at 125 Hz</span>
<span class="s2">    2. right and left electrooculograms (EOGs), sampled at 50 Hz</span>
<span class="s2">    3. a bipolar submental electromyogram (EMG), sampled at 125 Hz</span>
<span class="s2">    4. thoracic and abdominal excursions (THOR and ABDO), recorded by inductive plethysmography bands and sampled at 10 Hz</span>
<span class="s2">    5. &quot;AIRFLOW&quot; detected by a nasal-oral thermocouple, sampled at 10 Hz</span>
<span class="s2">    6. finger-tip pulse oximetry sampled at 1 Hz</span>
<span class="s2">    7. ECG from a bipolar lead, sampled at 125 Hz for most SHHS-1 studies and 250 (and 256?) Hz for SHHS-2 studies</span>
<span class="s2">    8. Heart rate (PR) derived from the ECG and sampled at 1 Hz</span>
<span class="s2">    9. body position (using a mercury gauge sensor)</span>
<span class="s2">    10. ambient light (on/off, by a light sensor secured to the recording garment)</span>

<span class="s2">    **ABOUT annotations** (NOT including &quot;nsrrid&quot;, &quot;visitnumber&quot;, &quot;pptid&quot; etc.):</span>

<span class="s2">    1. hrv annotations: (in csv files, ref. [2]_)</span>

<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | Start__sec_ | 5 minute window start time                                       |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | NN_RR       | Ratio of consecutive normal sinus beats (NN)                     |</span>
<span class="s2">        |             | over all cardiac inter-beat (RR) intervals (NN/RR)               |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | AVNN        | Mean of all normal sinus to normal sinus interbeat               |</span>
<span class="s2">        |             | intervals (NN)                                                   |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | IHR         | Instantaneous heart rate                                         |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | SDNN        | Standard deviation of all normal sinus                           |</span>
<span class="s2">        |             | to normal sinus interbeat (NN) intervals                         |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | SDANN       | Standard deviation of the averages of normal sinus to normal     |</span>
<span class="s2">        |             | sinus interbeat (NN) intervals in all 5-minute segments          |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | SDNNIDX     | Mean of the standard deviations of normal sinus to normal        |</span>
<span class="s2">        |             | sinus interbeat (NN) intervals in all 5-minute segments          |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | rMSSD       | Square root of the mean of the squares of difference between     |</span>
<span class="s2">        |             | adjacent normal sinus to normal sinus interbeat (NN) intervals   |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | pNN10       | Percentage of differences between adjacent normal sinus to       |</span>
<span class="s2">        |             | normal sinus interbeat (NN) intervals that are &gt;10 ms            |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | pNN20       | Percentage of differences between adjacent normal sinus to       |</span>
<span class="s2">        |             | normal sinus interbeat (NN) intervals that are &gt;20 ms            |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | pNN30       | Percentage of differences between adjacent normal sinus to       |</span>
<span class="s2">        |             | normal sinus interbeat (NN) intervals that are &gt;30 ms            |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | pNN40       | Percentage of differences between adjacent normal sinus to       |</span>
<span class="s2">        |             | normal sinus interbeat (NN) intervals that are &gt;40 ms            |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | pNN50       | Percentage of differences between adjacent normal sinus to       |</span>
<span class="s2">        |             | normal sinus interbeat (NN) intervals that are &gt;50 ms            |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | tot_pwr     | Total normal sinus to normal sinus interbeat (NN) interval       |</span>
<span class="s2">        |             | spectral power up to 0.4 Hz                                      |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | ULF         | Ultra-low frequency power, the normal sinus to normal sinus      |</span>
<span class="s2">        |             | interbeat (NN) interval spectral power between 0 and 0.003 Hz    |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | VLF         | Very low frequency power, the normal sinus to normal sinus       |</span>
<span class="s2">        |             | interbeat (NN) interval spectral power between 0.003 and 0.04 Hz |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | LF          | Low frequency power, the normal sinus to normal sinus interbeat  |</span>
<span class="s2">        |             | (NN) interval spectral power between 0.04 and 0.15 Hz            |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | HF          | High frequency power, the normal sinus to normal sinus interbeat |</span>
<span class="s2">        |             | (NN) interval spectral power between 0.15 and 0.4 Hz             |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | LF_HF       | The ratio of low to high frequency                               |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | LF_n        | Low frequency power (normalized)                                 |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>
<span class="s2">        | HF_n        | High frequency power (normalized)                                |</span>
<span class="s2">        +-------------+------------------------------------------------------------------+</span>

<span class="s2">    2. wave delineation annotations: (in csv files, NOTE: see &quot;CAUTION&quot; by the end of this part, ref. [2]_)</span>

<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | RPoint       | Sample Number indicating R Point (peak of QRS)                                                 |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | Start        | Sample Number indicating start of beat                                                         |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | End          | Sample Number indicating end of beat                                                           |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | STLevel1     | Level of ECG 1 in Raw data ( 65536 peak to peak rawdata = 10mV peak to peak)                   |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | STSlope1     | Slope of ECG 1 stored as int and to convert to a double divide raw value by 1000.0             |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | STLevel2     | Level of ECG 2 in Raw data ( 65536 peak to peak rawdata = 10mV peak to peak)                   |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | STSlope2     | Slope of ECG 2 stored as int and to convert to a double divide raw value by 1000.0             |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | Manual       | (True / False) True if record was manually inserted                                            |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | Type         | Type of beat (0 = Artifact / 1 = Normal Sinus Beat / 2 = VE / 3 = SVE)                         |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | Class        | no longer used                                                                                 |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | PPoint       | Sample Number indicating peak of the P wave (-1 if no P wave detected)                         |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | PStart       | Sample Number indicating start of the P wave                                                   |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | PEnd         | Sample Number indicating end of the P wave                                                     |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | TPoint       | Sample Number indicating peak of the T wave (-1 if no T wave detected)                         |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | TStart       | Sample Number indicating start of the T wave                                                   |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | TEnd         | Sample Number indicating end of the T wave                                                     |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | TemplateID   | The ID of the template to which this beat has been assigned (-1 if not assigned to a template) |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | nsrrid       | nsrrid of this record                                                                          |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | samplingrate | frequency of the ECG signal of this record                                                     |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | seconds      | Number of seconds from beginning of recording to R-point (Rpoint / sampling rate)              |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | epoch        | Epoch (30 second) number                                                                       |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>
<span class="s2">        | rpointadj    | R Point adjusted sample number (RPoint * (samplingrate/256))                                   |</span>
<span class="s2">        +--------------+------------------------------------------------------------------------------------------------+</span>

<span class="s2">      CAUTION that all the above sampling numbers except for rpointadj assume 256 Hz,</span>
<span class="s2">      while the rpointadj column has been added to provide an adjusted sample number based on the actual sampling rate.</span>

<span class="s2">    3. event annotations: (in xml files)</span>
<span class="s2">       TODO</span>
<span class="s2">    4. event_profusion annotations: (in xml files)</span>
<span class="s2">       TODO</span>

<span class="s2">    **DEFINITION of concepts in sleep study** (mainly apnea and arousal, ref. [8]_ for corresponding knowledge):</span>

<span class="s2">    1. Arousal: (ref. [3]_, [4]_)</span>

<span class="s2">        - interruptions of sleep lasting 3 to 15 seconds</span>
<span class="s2">        - can occur spontaneously or as a result of sleep-disordered breathing or other sleep disorders</span>
<span class="s2">        - sends you back to a lighter stage of sleep</span>
<span class="s2">        - if the arousal last more than 15 seconds, it becomes an awakening</span>
<span class="s2">        - the higher the arousal index (occurrences per hour), the more tired you are likely to feel, though people vary in their tolerance of sleep disruptions</span>

<span class="s2">    2. Central Sleep Apnea (CSA): (ref. [3]_, [5]_, [6]_)</span>

<span class="s2">        - breathing repeatedly stops and starts during sleep</span>
<span class="s2">        - occurs because your brain (central nervous system) doesn&#39;t send proper signals to the muscles that control your breathing, which is point that differs from obstructive sleep apnea</span>
<span class="s2">        - may occur as a result of other conditions, such as heart failure, stroke, high altitude, etc.</span>

<span class="s2">    3. Obstructive Sleep Apnea (OSA): (ref. [3]_, [7]_)</span>

<span class="s2">        - occurs when throat muscles intermittently relax and block upper airway during sleep</span>
<span class="s2">        - a noticeable sign of obstructive sleep apnea is snoring</span>

<span class="s2">    4. Complex (Mixed) Sleep Apnea: (ref. [3]_)</span>

<span class="s2">        - combination of both CSA and OSA</span>
<span class="s2">        - exact mechanism of the loss of central respiratory drive during sleep in OSA is unknown but is most likely related to incorrect settings of the CPAP (Continuous Positive Airway Pressure) treatment and other medical conditions the person has</span>

<span class="s2">    5. Hypopnea:</span>
<span class="s2">       overly shallow breathing or an abnormally low respiratory rate. Hypopnea is defined by some to be less severe than apnea (the complete cessation of breathing)</span>
<span class="s2">    6. Apnea Hypopnea Index (AHI): to write</span>

<span class="s2">        - used to indicate the severity of OSA</span>
<span class="s2">        - number of apneas or hypopneas recorded during the study per hour of sleep</span>
<span class="s2">        - based on the AHI, the severity of OSA is classified as follows</span>

<span class="s2">            - none/minimal: AHI &lt; 5 per hour</span>
<span class="s2">            - mild: AHI ≥ 5, but &lt; 15 per hour</span>
<span class="s2">            - moderate: AHI ≥ 15, but &lt; 30 per hour</span>
<span class="s2">            - severe: AHI ≥ 30 per hour</span>

<span class="s2">    7. Oxygen Desaturation:</span>

<span class="s2">        - used to indicate the severity of OSA</span>
<span class="s2">        - reductions in blood oxygen levels (desaturation)</span>
<span class="s2">        - at sea level, a normal blood oxygen level (saturation) is usually 96 - 97%</span>
<span class="s2">        - (no generally accepted classifications for severity of oxygen desaturation)</span>

<span class="s2">            - mild: &gt;= 90%</span>
<span class="s2">            - moderate: 80</span><span class="si">% - 89%</span>
<span class="s2">            - severe: &lt; 80%</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">usage</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;Sleep stage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Sleep apnea&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">issues</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    1. `Start__sec_` might not be the start time, but rather the end time, of the 5 minute windows in some records</span>
<span class="s2">    2. the current version &quot;0.15.0&quot; removed EEG spectral summary variables</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">references</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;https://sleepdata.org/datasets/shhs/pages/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://sleepdata.org/datasets/shhs/pages/13-hrv-analysis.md&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://en.wikipedia.org/wiki/Sleep_apnea&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://www.sleepapnea.org/diagnosis/sleep-studies/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://www.mayoclinic.org/diseases-conditions/central-sleep-apnea/symptoms-causes/syc-20352109&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Eckert DJ, Jordan AS, Merchia P, Malhotra A. Central sleep apnea: Pathophysiology and treatment. Chest. 2007 Feb;131(2):595-607. doi: 10.1378/chest.06.2287. PMID: 17296668; PMCID: PMC2287191.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://www.mayoclinic.org/diseases-conditions/obstructive-sleep-apnea/symptoms-causes/syc-20352090&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://en.wikipedia.org/wiki/Hypopnea&quot;</span><span class="p">,</span>
        <span class="c1"># &quot;http://healthysleep.med.harvard.edu/sleep-apnea/diagnosing-osa/understanding-results&quot;,  # broken link</span>
        <span class="s2">&quot;https://sleepdata.org/datasets/shhs/pages/full-description.md&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">doi</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;10.1093/jamia/ocy064&quot;</span><span class="p">,</span>
    <span class="p">],</span>  <span class="c1"># PMID: 9493915 not added</span>
<span class="p">)</span>


<div class="viewcode-block" id="SHHS">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS">[docs]</a>
<span class="nd">@add_docstring</span><span class="p">(</span><span class="n">_SHHS_INFO</span><span class="o">.</span><span class="n">format_database_docstring</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;prepend&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SHHS</span><span class="p">(</span><span class="n">NSRRDataBase</span><span class="p">,</span> <span class="n">PSGDataBaseMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    db_dir : `path-like`, optional</span>
<span class="sd">        Storage path of the database.</span>
<span class="sd">    working_dir : `path-like`, optional</span>
<span class="sd">        Working directory, to store intermediate files and log files.</span>
<span class="sd">    verbose : int, default 1</span>
<span class="sd">        Level of logging verbosity.</span>
<span class="sd">    kwargs : dict, optional</span>
<span class="sd">        Auxilliary key word arguments</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;SHHS&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">db_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">working_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">db_name</span><span class="o">=</span><span class="s2">&quot;SHHS&quot;</span><span class="p">,</span>
            <span class="n">db_dir</span><span class="o">=</span><span class="n">db_dir</span><span class="p">,</span>
            <span class="n">working_dir</span><span class="o">=</span><span class="n">working_dir</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__create_constants</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># `current_version` will be when calling `_ls_rec`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_version</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_version&quot;</span><span class="p">,</span> <span class="s2">&quot;0.19.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_pattern</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d+</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d+&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rec_name_pattern</span> <span class="o">=</span> <span class="s2">&quot;^shhs[12]</span><span class="se">\\</span><span class="s2">-</span><span class="se">\\</span><span class="s2">d</span><span class="si">{6}</span><span class="s2">$&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">psg_data_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ann_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hrv_ann_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eeg_ann_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave_deli_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_ann_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_profusion_ann_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form_paths</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_hrv_summary_ann</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_hrv_detailed_ann</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_event_ann</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_event_profusion_ann</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_rpeaks_ann</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ls_rec</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="SHHS.form_paths">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.form_paths">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">form_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Form paths to the database files.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psg_data_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dir</span> <span class="o">/</span> <span class="s2">&quot;polysomnography&quot;</span> <span class="o">/</span> <span class="s2">&quot;edfs&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ann_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dir</span> <span class="o">/</span> <span class="s2">&quot;datasets&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hrv_ann_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_path</span> <span class="o">/</span> <span class="s2">&quot;hrv-analysis&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eeg_ann_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_path</span> <span class="o">/</span> <span class="s2">&quot;eeg-spectral-analysis&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave_deli_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dir</span> <span class="o">/</span> <span class="s2">&quot;polysomnography&quot;</span> <span class="o">/</span> <span class="s2">&quot;annotations-rpoints&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_ann_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dir</span> <span class="o">/</span> <span class="s2">&quot;polysomnography&quot;</span> <span class="o">/</span> <span class="s2">&quot;annotations-events-nsrr&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_profusion_ann_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dir</span> <span class="o">/</span> <span class="s2">&quot;polysomnography&quot;</span> <span class="o">/</span> <span class="s2">&quot;annotations-events-profusion&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_ls_rec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find all records in the database directory</span>
<span class="sd">        and store them (path, metadata, etc.) in some private attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finding `edf` records....&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dir</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.edf&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">),</span>
                <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subsample</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">)))),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">DEFAULTS</span><span class="o">.</span><span class="n">SEED</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># if self._df_records is non-empty, call `form_paths` again if necessary</span>
        <span class="c1"># typically path for a record is like:</span>
        <span class="c1"># self.db_dir / &quot;polysomnography/edfs/shhs1/shhs1-200001.edf&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">form_paths</span><span class="p">()</span>

        <span class="c1"># get other columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">[</span><span class="s2">&quot;record&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">[</span><span class="s2">&quot;tranche&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">[</span><span class="s2">&quot;record&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">[</span><span class="s2">&quot;visitnumber&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">[</span><span class="s2">&quot;record&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">:]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">[</span><span class="s2">&quot;nsrrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">[</span><span class="s2">&quot;record&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># auxiliary and annotation files</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_or_file</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;tranche&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;record&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span><span class="p">[</span><span class="n">key</span><span class="p">]),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;record&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># update `current_version`</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_pattern</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_version</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_pattern</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">break</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading tables....&quot;</span><span class="p">)</span>
            <span class="c1"># gather tables in self.ann_path and in self.hrv_ann_path</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ann_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.csv&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrv_ann_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.csv&quot;</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.csv&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">table_name</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finding records with HRV annotations....&quot;</span><span class="p">)</span>
        <span class="c1"># find records with hrv annotations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_hrv_summary_ann</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;shhs1-hrv-summary&quot;</span><span class="p">,</span> <span class="s2">&quot;shhs2-hrv-summary&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_hrv_summary_ann</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;shhs</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;visitnumber&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;nsrrid&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_hrv_summary_ann</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec_with_hrv_summary_ann</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_hrv_detailed_ann</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;shhs1-hrv-5min&quot;</span><span class="p">,</span> <span class="s2">&quot;shhs2-hrv-5min&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_hrv_detailed_ann</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;shhs</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;visitnumber&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;nsrrid&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_hrv_detailed_ann</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec_with_hrv_detailed_ann</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finding records with rpeaks annotations....&quot;</span><span class="p">)</span>
        <span class="c1"># find available rpeak annotation files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_rpeaks_ann</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-rpoint&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_deli_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;shhs*-rpoint.csv&quot;</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finding records with event annotations....&quot;</span><span class="p">)</span>
        <span class="c1"># find available event annotation files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_event_ann</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-nsrr&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_ann_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;shhs*-nsrr.xml&quot;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_event_profusion_ann</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-profusion&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_profusion_ann_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;shhs*-profusion.xml&quot;</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">[</span><span class="s2">&quot;available_signals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lazy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_available_signals</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># END OF `_ls_rec`</span>

<div class="viewcode-block" id="SHHS.list_table_names">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.list_table_names">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_table_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List available table names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<div class="viewcode-block" id="SHHS.get_table">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.get_table">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get table by name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        table_name : str</span>
<span class="sd">            Table name.</span>
<span class="sd">            For available table names, call method :meth:`list_table_names`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        table : pandas.DataFrame</span>
<span class="sd">            The loaded table.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span></div>


<div class="viewcode-block" id="SHHS.update_sleep_stage_names">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.update_sleep_stage_names">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_sleep_stage_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update :attr:`self.sleep_stage_names`</span>
<span class="sd">        according to :attr:`self.sleep_stage_protocol`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_protocol</span> <span class="o">==</span> <span class="s2">&quot;aasm&quot;</span><span class="p">:</span>
            <span class="n">nb_stages</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_protocol</span> <span class="o">==</span> <span class="s2">&quot;simplified&quot;</span><span class="p">:</span>
            <span class="n">nb_stages</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_protocol</span> <span class="o">==</span> <span class="s2">&quot;shhs&quot;</span><span class="p">:</span>
            <span class="n">nb_stages</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No stage protocol named `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_protocol</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_sleep_stage_names</span><span class="p">[:</span><span class="n">nb_stages</span><span class="p">]</span></div>


<div class="viewcode-block" id="SHHS.get_subject_id">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.get_subject_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_subject_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attach a unique subject ID for the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pid : int</span>
<span class="sd">            Subject ID derived from (attached to) the record.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>
        <span class="n">head_shhs1</span><span class="p">,</span> <span class="n">head_shhs2v3</span><span class="p">,</span> <span class="n">head_shhs2v4</span> <span class="o">=</span> <span class="s2">&quot;30000&quot;</span><span class="p">,</span> <span class="s2">&quot;30001&quot;</span><span class="p">,</span> <span class="s2">&quot;30002&quot;</span>
        <span class="n">tranche</span><span class="p">,</span> <span class="n">nsrrid</span><span class="p">,</span> <span class="n">visitnumber</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">split_rec_name</span><span class="p">(</span><span class="n">rec</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tranche&quot;</span><span class="p">,</span> <span class="s2">&quot;nsrrid&quot;</span><span class="p">,</span> <span class="s2">&quot;visitnumber&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">visitnumber</span> <span class="o">==</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;SHHS2 has two different sampling frequencies, &quot;</span> <span class="s2">&quot;currently could not be distinguished using only `rec`&quot;</span>
            <span class="p">)</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">head_shhs1</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">visitnumber</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nsrrid</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pid</span></div>


<div class="viewcode-block" id="SHHS.get_available_signals">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.get_available_signals">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_available_signals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get available signals for a record.</span>

<span class="sd">        If input `rec` is None,</span>
<span class="sd">        this function finds available signals for all records,</span>
<span class="sd">        and assign to :attr:`self._df_records[&#39;available_signals&#39;]`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        available_signals : List[str]</span>
<span class="sd">            Names of available signals for `rec`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># iterrows with tqdm</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span>
                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="p">),</span>
                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Finding available signals&quot;</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;record&quot;</span><span class="p">,</span>
                <span class="n">dynamic_ncols</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">mininterval</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">disable</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">):</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">name</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rec</span><span class="p">,</span> <span class="s2">&quot;available_signals&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">available_signals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_available_signals</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">rec</span><span class="p">,</span> <span class="s2">&quot;available_signals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">available_signals</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">available_signals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rec</span><span class="p">,</span> <span class="s2">&quot;available_signals&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">available_signals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_signals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">available_signals</span>

            <span class="n">frp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_absolute_path</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># perhaps broken file</span>
                <span class="c1"># or the downloading is not finished</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">safe_edf_file_operation</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="n">frp</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">available_signals</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getSignalLabels</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">safe_edf_file_operation</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_df_records</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">rec</span><span class="p">,</span> <span class="s2">&quot;available_signals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">available_signals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_signals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_signals</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">available_signals</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">available_signals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">available_signals</span></div>


<div class="viewcode-block" id="SHHS.split_rec_name">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.split_rec_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">split_rec_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split `rec` into `tranche`, `visitnumber`, `nsrrid`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in attr:`self.all_records`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Keys: &quot;tranche&quot;, &quot;visitnumber&quot;, &quot;nsrrid&quot;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec_name_pattern</span><span class="p">,</span> <span class="n">rec</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Invalid record name: `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">`&quot;</span>
        <span class="n">tranche</span><span class="p">,</span> <span class="n">nsrrid</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">visitnumber</span> <span class="o">=</span> <span class="n">tranche</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;tranche&quot;</span><span class="p">:</span> <span class="n">tranche</span><span class="p">,</span>
            <span class="s2">&quot;visitnumber&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">visitnumber</span><span class="p">),</span>
            <span class="s2">&quot;nsrrid&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">nsrrid</span><span class="p">),</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="SHHS.get_visitnumber">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.get_visitnumber">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_visitnumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get ``visitnumber`` from `rec`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Visit number extracted from `rec`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_rec_name</span><span class="p">(</span><span class="n">rec</span><span class="p">)[</span><span class="s2">&quot;visitnumber&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="SHHS.get_tranche">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.get_tranche">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_tranche</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get ``tranche`` (&quot;shhs1&quot; or &quot;shhs2&quot;) from `rec`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Tranche extracted from `rec`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_rec_name</span><span class="p">(</span><span class="n">rec</span><span class="p">)[</span><span class="s2">&quot;tranche&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="SHHS.get_nsrrid">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.get_nsrrid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_nsrrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get ``nsrrid`` from `rec`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            ``nsrrid`` extracted from `rec`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_rec_name</span><span class="p">(</span><span class="n">rec</span><span class="p">)[</span><span class="s2">&quot;nsrrid&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="SHHS.get_fs">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.get_fs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_fs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ECG&quot;</span><span class="p">,</span>
        <span class="n">rec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Real</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the sampling frequency of a signal of a record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        sig : str, default &quot;ECG&quot;</span>
<span class="sd">            Signal name or annotation name (e.g. &quot;rpeak&quot;).</span>
<span class="sd">            Some annotation files (\\*-rpeak.csv) have</span>
<span class="sd">            a sampling frequency column.</span>
<span class="sd">        rec_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the PSG data.</span>
<span class="sd">            If is None, default path will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fs : numbers.Real</span>
<span class="sd">            Sampling frequency of the signal `sig` of the record `rec`.</span>
<span class="sd">            If corresponding signal (.edf) file is not available,</span>
<span class="sd">            or the signal file does not contain the signal `sig`,</span>
<span class="sd">            -1 will be returned.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_channel</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">sig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_signals</span><span class="o">.</span><span class="n">union</span><span class="p">({</span><span class="s2">&quot;rpeak&quot;</span><span class="p">}),</span> <span class="sa">f</span><span class="s2">&quot;Invalid signal name: `</span><span class="si">{</span><span class="n">sig</span><span class="si">}</span><span class="s2">`&quot;</span>
        <span class="k">if</span> <span class="n">sig</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;rpeak&quot;</span><span class="p">:</span>
            <span class="n">df_rpeaks_with_type_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_wave_delineation_ann</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df_rpeaks_with_type_info</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rpeak annotation file corresponding to `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` is not available.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">return</span> <span class="n">df_rpeaks_with_type_info</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;samplingrate&quot;</span><span class="p">]</span>

        <span class="n">frp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_absolute_path</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">rec_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">frp</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signal (.edf) file corresponding to `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` is not available.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safe_edf_file_operation</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="n">frp</span><span class="p">)</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_channel</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="n">available_signals</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getSignalLabels</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">sig</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_signals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signal `</span><span class="si">{</span><span class="n">sig</span><span class="si">}</span><span class="s2">` is not available in signal file corresponding to `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">`.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">chn_num</span> <span class="o">=</span> <span class="n">available_signals</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getSampleFrequency</span><span class="p">(</span><span class="n">chn_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safe_edf_file_operation</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fs</span></div>


<div class="viewcode-block" id="SHHS.get_chn_num">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.get_chn_num">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_chn_num</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ECG&quot;</span><span class="p">,</span>
        <span class="n">rec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the index of the channel of the signal in the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        sig : str, default &quot;ECG&quot;</span>
<span class="sd">            Signal name.</span>
<span class="sd">        rec_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the PSG data.</span>
<span class="sd">            If is None, default path will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        chn_num : int</span>
<span class="sd">            Index of channel of the signal `sig` of the record `rec`.</span>
<span class="sd">            Returns -1</span>
<span class="sd">            if corresponding signal (.edf) file is not available,</span>
<span class="sd">            or the signal file does not contain the signal `sig`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_channel</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="n">available_signals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_available_signals</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sig</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_signals</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Signal (.edf) file corresponding to `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` is not available, or&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;signal `</span><span class="si">{</span><span class="n">sig</span><span class="si">}</span><span class="s2">` is not available in signal file corresponding to `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">chn_num</span> <span class="o">=</span> <span class="n">available_signals</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match_channel</span><span class="p">(</span><span class="n">sig</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">chn_num</span></div>


<div class="viewcode-block" id="SHHS.match_channel">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.match_channel">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">match_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">raise_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Match the channel name to the standard channel name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        channel : str</span>
<span class="sd">            Channel name.</span>
<span class="sd">        raise_error : bool, default True</span>
<span class="sd">            Whether to raise error if no match is found.</span>
<span class="sd">            If False, returns the input `channel` directly.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sig : str</span>
<span class="sd">            Standard channel name in SHHS.</span>
<span class="sd">            If no match is found, and `raise_error` is False,</span>
<span class="sd">            returns the input `channel` directly.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_signals</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">channel</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">raise_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No channel named `</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">channel</span></div>


<div class="viewcode-block" id="SHHS.get_absolute_path">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.get_absolute_path">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_absolute_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">rec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rec_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;psg&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the absolute path of specific type of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        rec_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the desired data.</span>
<span class="sd">            If is None, default path will be used.</span>
<span class="sd">        rec_type : str, default &quot;psg&quot;</span>
<span class="sd">            Record type, either data (psg, etc.) or annotations.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rp : pathlib.Path</span>
<span class="sd">            Absolute path of the record `rec` with type `rec_type`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rp</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">rec_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">rp</span>

        <span class="k">assert</span> <span class="n">rec_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_or_file</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;`rec_type` should be one of &quot;</span> <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder_or_file</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">`, but got `</span><span class="si">{</span><span class="n">rec_type</span><span class="si">}</span><span class="s2">`&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>

        <span class="n">tranche</span><span class="p">,</span> <span class="n">nsrrid</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">split_rec_name</span><span class="p">(</span><span class="n">rec</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tranche&quot;</span><span class="p">,</span> <span class="s2">&quot;nsrrid&quot;</span><span class="p">]]</span>
        <span class="c1"># rp = self._df_records.loc[rec, rec_type]</span>
        <span class="n">rp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_or_file</span><span class="p">[</span><span class="n">rec_type</span><span class="p">]</span> <span class="o">/</span> <span class="n">tranche</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rec</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">extension</span><span class="p">[</span><span class="n">rec_type</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">rp</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">database_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<div class="viewcode-block" id="SHHS.show_rec_stats">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.show_rec_stats">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show_rec_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">rec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the statistics of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        rec_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the PSG data.</span>
<span class="sd">            If is None, default path will be used.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">frp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_absolute_path</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">rec_path</span><span class="p">,</span> <span class="n">rec_type</span><span class="o">=</span><span class="s2">&quot;psg&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safe_edf_file_operation</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="n">frp</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">chn</span><span class="p">,</span> <span class="n">lb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getSignalLabels</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SignalLabel:&quot;</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prefilter:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getPrefilter</span><span class="p">(</span><span class="n">chn</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transducer:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getTransducer</span><span class="p">(</span><span class="n">chn</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PhysicalDimension:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getPhysicalDimension</span><span class="p">(</span><span class="n">chn</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SampleFrequency:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getSampleFrequency</span><span class="p">(</span><span class="n">chn</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safe_edf_file_operation</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="SHHS.load_psg_data">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_psg_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_psg_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">rec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sampfrom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Real</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sampto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Real</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">physical</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Real</span><span class="p">]],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Real</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load PSG data of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        channel : str, default &quot;all&quot;</span>
<span class="sd">            Name of the channel of PSG.</span>
<span class="sd">            If is &quot;all&quot;, then all channels will be returned.</span>
<span class="sd">        rec_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the PSG data.</span>
<span class="sd">            If is None, default path will be used.</span>
<span class="sd">        sampfrom : numbers.Real, optional</span>
<span class="sd">            Start time (units in seconds) of the data to be loaded,</span>
<span class="sd">            valid only when `channel` is some specific channel.</span>
<span class="sd">        sampto : numbers.Real, optional</span>
<span class="sd">            End time (units in seconds) of the data to be loaded,</span>
<span class="sd">            valid only when `channel` is some specific channel</span>
<span class="sd">        fs : numbers.Real, optional</span>
<span class="sd">            Sampling frequency of the loaded data.</span>
<span class="sd">            If not None, the loaded data will be resampled to this frequency,</span>
<span class="sd">            otherwise, the original sampling frequency will be used.</span>
<span class="sd">            Valid only when `channel` is some specific channel.</span>
<span class="sd">        physical : bool, default True</span>
<span class="sd">            If True, then the data will be converted to physical units,</span>
<span class="sd">            otherwise, the data will be in digital units.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict or tuple</span>
<span class="sd">            If `channel` is &quot;all&quot;, then a dictionary will be returned:</span>

<span class="sd">                - keys: PSG channel names;</span>
<span class="sd">                - values: PSG data and sampling frequency</span>

<span class="sd">            Otherwise, a 2-tuple will be returned:</span>
<span class="sd">            (:class:`numpy.ndarray`, :class:`numbers.Real`), which is the</span>
<span class="sd">            PSG data of the channel `channel` and its sampling frequency.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span> <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span> <span class="k">else</span> <span class="s2">&quot;all&quot;</span>
        <span class="n">frp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_absolute_path</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">rec_path</span><span class="p">,</span> <span class="n">rec_type</span><span class="o">=</span><span class="s2">&quot;psg&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safe_edf_file_operation</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="n">frp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">chn</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">ret_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">readSignal</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">digital</span><span class="o">=</span><span class="ow">not</span> <span class="n">physical</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getSampleFrequency</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getSignalLabels</span><span class="p">())</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_signals</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getSignalLabels</span><span class="p">()]</span>
            <span class="k">assert</span> <span class="n">chn</span> <span class="ow">in</span> <span class="n">all_signals</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;`channel` should be one of `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getSignalLabels</span><span class="p">()</span><span class="si">}</span><span class="s2">`, but got `</span><span class="si">{</span><span class="n">chn</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">all_signals</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">chn</span><span class="p">)</span>
            <span class="n">data_fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">getSampleFrequency</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_opened</span><span class="o">.</span><span class="n">readSignal</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">digital</span><span class="o">=</span><span class="ow">not</span> <span class="n">physical</span><span class="p">)</span>
            <span class="c1"># the `readSignal` method of `EdfReader` does NOT treat</span>
            <span class="c1"># the parameters `start` and `n` correctly</span>
            <span class="c1"># so we have to do it manually</span>
            <span class="k">if</span> <span class="n">sampfrom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">idx_from</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sampfrom</span> <span class="o">*</span> <span class="n">data_fs</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx_from</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">sampto</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">idx_to</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sampto</span> <span class="o">*</span> <span class="n">data_fs</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx_to</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">idx_from</span><span class="p">:</span><span class="n">idx_to</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fs</span> <span class="o">!=</span> <span class="n">data_fs</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">SS</span><span class="o">.</span><span class="n">resample_poly</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">data_fs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                <span class="n">data_fs</span> <span class="o">=</span> <span class="n">fs</span>
            <span class="n">ret_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_fs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">safe_edf_file_operation</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret_data</span></div>


<div class="viewcode-block" id="SHHS.load_ecg_data">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_ecg_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_ecg_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">rec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sampfrom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sampto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;channel_first&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;mV&quot;</span><span class="p">,</span>
        <span class="n">fs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">return_fs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Real</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load ECG data of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        rec_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the ECG data.</span>
<span class="sd">            If is None, default path will be used.</span>
<span class="sd">        sampfrom : int, optional</span>
<span class="sd">            Start index of the data to be loaded.</span>
<span class="sd">        sampto : int, optional</span>
<span class="sd">            End index of the data to be loaded.</span>
<span class="sd">        data_format : str, default &quot;channel_first&quot;</span>
<span class="sd">            Format of the ECG data,</span>
<span class="sd">            &quot;channel_last&quot; (alias &quot;lead_last&quot;), or</span>
<span class="sd">            &quot;channel_first&quot; (alias &quot;lead_first&quot;), or</span>
<span class="sd">            &quot;flat&quot; (alias &quot;plain&quot;) which is valid only when `leads` is a single lead.</span>
<span class="sd">        units : str or None, default &quot;mV&quot;</span>
<span class="sd">            Units of the output signal, can also be &quot;μV&quot; (aliases &quot;uV&quot;, &quot;muV&quot;).</span>
<span class="sd">            None for digital data, without digital-to-physical conversion.</span>
<span class="sd">        fs : numbers.Real, optional</span>
<span class="sd">            Sampling frequency of the loaded data.</span>
<span class="sd">            If not None, the loaded data will be resampled to this frequency,</span>
<span class="sd">            otherwise, the original sampling frequency will be used.</span>
<span class="sd">        return_fs : bool, default True</span>
<span class="sd">            Whether to return the sampling frequency of the output signal.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : numpy.ndarray</span>
<span class="sd">            The loaded ECG data.</span>
<span class="sd">        data_fs : numbers.Real</span>
<span class="sd">            Sampling frequency of the loaded ECG data.</span>
<span class="sd">            Returned if `return_fs` is True.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allowed_data_format</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;channel_first&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lead_first&quot;</span><span class="p">,</span>
            <span class="s2">&quot;channel_last&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lead_last&quot;</span><span class="p">,</span>
            <span class="s2">&quot;flat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;plain&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">data_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">allowed_data_format</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;`data_format` should be one of `</span><span class="si">{</span><span class="n">allowed_data_format</span><span class="si">}</span><span class="s2">`, but got `</span><span class="si">{</span><span class="n">data_format</span><span class="si">}</span><span class="s2">`&quot;</span>
        <span class="n">allowed_units</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mv&quot;</span><span class="p">,</span> <span class="s2">&quot;uv&quot;</span><span class="p">,</span> <span class="s2">&quot;μv&quot;</span><span class="p">,</span> <span class="s2">&quot;muv&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">allowed_units</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;`units` should be one of `</span><span class="si">{</span><span class="n">allowed_units</span><span class="si">}</span><span class="s2">` or None, but got `</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">`&quot;</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">data_fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_psg_data</span><span class="p">(</span>
            <span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span>
            <span class="n">channel</span><span class="o">=</span><span class="s2">&quot;ecg&quot;</span><span class="p">,</span>
            <span class="n">rec_path</span><span class="o">=</span><span class="n">rec_path</span><span class="p">,</span>
            <span class="n">sampfrom</span><span class="o">=</span><span class="n">sampfrom</span><span class="p">,</span>
            <span class="n">sampto</span><span class="o">=</span><span class="n">sampto</span><span class="p">,</span>
            <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
            <span class="n">physical</span><span class="o">=</span><span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">DEFAULTS</span><span class="o">.</span><span class="n">DTYPE</span><span class="o">.</span><span class="n">NP</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;μv&quot;</span><span class="p">,</span> <span class="s2">&quot;uv&quot;</span><span class="p">,</span> <span class="s2">&quot;muv&quot;</span><span class="p">]:</span>
            <span class="n">data</span> <span class="o">*=</span> <span class="mf">1e3</span>
        <span class="k">if</span> <span class="n">data_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;channel_first&quot;</span><span class="p">,</span> <span class="s2">&quot;lead_first&quot;</span><span class="p">]:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">elif</span> <span class="n">data_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;channel_last&quot;</span><span class="p">,</span> <span class="s2">&quot;lead_last&quot;</span><span class="p">]:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">return_fs</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_fs</span>
        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="SHHS.load_data">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_data">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span>
        <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="s2">&quot;NOTE: one should call `load_psg_data` to load other channels.&quot;</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="n">load_ecg_data</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">rec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sampfrom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sampto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;channel_first&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;mV&quot;</span><span class="p">,</span>
        <span class="n">fs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">return_fs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Real</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;alias of `load_ecg_data`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_ecg_data</span><span class="p">(</span>
            <span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span>
            <span class="n">rec_path</span><span class="o">=</span><span class="n">rec_path</span><span class="p">,</span>
            <span class="n">sampfrom</span><span class="o">=</span><span class="n">sampfrom</span><span class="p">,</span>
            <span class="n">sampto</span><span class="o">=</span><span class="n">sampto</span><span class="p">,</span>
            <span class="n">data_format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
            <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
            <span class="n">return_fs</span><span class="o">=</span><span class="n">return_fs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="SHHS.load_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">ann_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load annotations of specific type of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        ann_type : str,</span>
<span class="sd">            Type of the annotation, can be</span>
<span class="sd">            &quot;event&quot;, &quot;event_profusion&quot;, &quot;hrv_summary&quot;, &quot;hrv_detailed&quot;,</span>
<span class="sd">            &quot;sleep&quot;, &quot;sleep_stage&quot;, &quot;sleep_event&quot;, &quot;apnea&quot; (alias &quot;sleep_apnea&quot;),</span>
<span class="sd">            &quot;wave_delineation&quot;, &quot;rpeak&quot;, &quot;rr&quot;, &quot;nn&quot;.</span>
<span class="sd">        ann_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the annotations.</span>
<span class="sd">            If is None, default path will be used.</span>
<span class="sd">        kwargs : dict, optional</span>
<span class="sd">            Other arguments for specific annotation type.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        annotations : numpy.ndarray or pandas.DataFrame or dict</span>
<span class="sd">            The loaded annotations.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ann_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;event&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_event_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">event_ann_path</span><span class="o">=</span><span class="n">ann_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ann_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;event_profusion&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_event_profusion_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">event_profusion_ann_path</span><span class="o">=</span><span class="n">ann_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ann_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;hrv_summary&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_hrv_summary_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">hrv_ann_path</span><span class="o">=</span><span class="n">ann_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ann_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;hrv_detailed&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_hrv_detailed_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">hrv_ann_path</span><span class="o">=</span><span class="n">ann_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ann_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sleep&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sleep_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">sleep_ann_path</span><span class="o">=</span><span class="n">ann_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ann_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sleep_stage&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sleep_stage_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">sleep_stage_ann_path</span><span class="o">=</span><span class="n">ann_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ann_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sleep_event&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sleep_event_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">sleep_event_ann_path</span><span class="o">=</span><span class="n">ann_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ann_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sleep_apnea&quot;</span><span class="p">,</span> <span class="s2">&quot;apnea&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_apnea_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">apnea_ann_path</span><span class="o">=</span><span class="n">ann_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ann_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;wave_delineation&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_wave_delineation_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">wave_deli_path</span><span class="o">=</span><span class="n">ann_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ann_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;rpeak&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_rpeak_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">rpeak_ann_path</span><span class="o">=</span><span class="n">ann_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ann_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;rr&quot;</span><span class="p">,</span> <span class="s2">&quot;rr_interval&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_rr_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">rpeak_ann_path</span><span class="o">=</span><span class="n">ann_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ann_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;nn&quot;</span><span class="p">,</span> <span class="s2">&quot;nn_interval&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_nn_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">rpeak_ann_path</span><span class="o">=</span><span class="n">ann_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="SHHS.load_event_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_event_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_event_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">event_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">simplify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load event annotations of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        event_ann_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the events-nsrr annotations.</span>
<span class="sd">            If is None, default path will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df_events : pandas.DataFrame</span>
<span class="sd">            Event annotations of the record.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_absolute_path</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">event_ann_path</span><span class="p">,</span> <span class="n">rec_type</span><span class="o">=</span><span class="s2">&quot;event&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="c1"># rec not in `self.rec_with_event_ann`</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">xtd</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">file_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
        <span class="n">df_events</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;PSGAnnotation&quot;</span><span class="p">][</span><span class="s2">&quot;ScoredEvents&quot;</span><span class="p">][</span><span class="s2">&quot;ScoredEvent&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">simplify</span><span class="p">:</span>
            <span class="n">df_events</span><span class="p">[</span><span class="s2">&quot;EventType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_events</span><span class="p">[</span><span class="s2">&quot;EventType&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">df_events</span><span class="p">[</span><span class="s2">&quot;EventConcept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_events</span><span class="p">[</span><span class="s2">&quot;EventConcept&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;Duration&quot;</span><span class="p">,</span> <span class="s2">&quot;SpO2Nadir&quot;</span><span class="p">,</span> <span class="s2">&quot;SpO2Baseline&quot;</span><span class="p">]:</span>
            <span class="n">df_events</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_events</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str_to_real_number</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df_events</span></div>


<div class="viewcode-block" id="SHHS.load_event_profusion_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_event_profusion_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_event_profusion_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">event_profusion_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load events-profusion annotations of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        event_profusion_ann_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the events-profusion annotations.</span>
<span class="sd">            If is None, default path will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Event-profusions annotations of the record,</span>
<span class="sd">            with items &quot;sleep_stage_list&quot;, &quot;df_events&quot;.</span>

<span class="sd">        TODO</span>
<span class="sd">        ----</span>
<span class="sd">        Merge &quot;sleep_stage_list&quot; and &quot;df_events&quot; into one :class:`~pandas.DataFrame`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_absolute_path</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">event_profusion_ann_path</span><span class="p">,</span> <span class="n">rec_type</span><span class="o">=</span><span class="s2">&quot;event_profusion&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="c1"># rec not in `self.rec_with_event_profusion_ann`</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;sleep_stage_list&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;df_events&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()}</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">xtd</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">file_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
        <span class="n">sleep_stage_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;CMPStudyConfig&quot;</span><span class="p">][</span><span class="s2">&quot;SleepStages&quot;</span><span class="p">][</span><span class="s2">&quot;SleepStage&quot;</span><span class="p">]]</span>
        <span class="n">df_events</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;CMPStudyConfig&quot;</span><span class="p">][</span><span class="s2">&quot;ScoredEvents&quot;</span><span class="p">][</span><span class="s2">&quot;ScoredEvent&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;Duration&quot;</span><span class="p">,</span> <span class="s2">&quot;LowestSpO2&quot;</span><span class="p">,</span> <span class="s2">&quot;Desaturation&quot;</span><span class="p">]:</span>
            <span class="n">df_events</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_events</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str_to_real_number</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sleep_stage_list&quot;</span><span class="p">:</span> <span class="n">sleep_stage_list</span><span class="p">,</span> <span class="s2">&quot;df_events&quot;</span><span class="p">:</span> <span class="n">df_events</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="SHHS.load_hrv_summary_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_hrv_summary_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_hrv_summary_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hrv_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load summary HRV annotations of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        hrv_ann_path : `path-like`, optional</span>
<span class="sd">            Path of the summary HRV annotation file.</span>
<span class="sd">            If is None, default path will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df_hrv_ann : pandas.DataFrame</span>
<span class="sd">            If `rec` is not None, `df_hrv_ann` is the summary HRV annotations of `rec`;</span>
<span class="sd">            if `rec` is None, `df_hrv_ann` is the summary HRV annotations of all records</span>
<span class="sd">            that had HRV annotations (about 10% of all the records in SHHS).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_hrv_ann</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;shhs1-hrv-summary&quot;</span><span class="p">,</span> <span class="s2">&quot;shhs2-hrv-summary&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span>
                <span class="p">],</span>
                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">df_hrv_ann</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rec</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_hrv_summary_ann</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">tranche</span><span class="p">,</span> <span class="n">nsrrid</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">split_rec_name</span><span class="p">(</span><span class="n">rec</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tranche&quot;</span><span class="p">,</span> <span class="s2">&quot;nsrrid&quot;</span><span class="p">]]</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tranche</span><span class="si">}</span><span class="s2">-hrv-summary&quot;</span>
        <span class="n">df_hrv_ann</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span><span class="o">.</span><span class="n">nsrrid</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">nsrrid</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_hrv_ann</span></div>


<div class="viewcode-block" id="SHHS.load_hrv_detailed_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_hrv_detailed_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_hrv_detailed_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">hrv_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load detailed HRV annotations of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        hrv_ann_path : `path-like`, optional</span>
<span class="sd">            Path of the detailed HRV annotation file.</span>
<span class="sd">            If is None, default path will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df_hrv_ann : pandas.DataFrame.</span>
<span class="sd">            Detailed HRV annotations of the record.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rec</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_with_hrv_detailed_ann</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">tranche</span><span class="p">,</span> <span class="n">nsrrid</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">split_rec_name</span><span class="p">(</span><span class="n">rec</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tranche&quot;</span><span class="p">,</span> <span class="s2">&quot;nsrrid&quot;</span><span class="p">]]</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tranche</span><span class="si">}</span><span class="s2">-hrv-5min&quot;</span>
        <span class="n">df_hrv_ann</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span><span class="o">.</span><span class="n">nsrrid</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">nsrrid</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df_hrv_ann</span></div>


<div class="viewcode-block" id="SHHS.load_sleep_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_sleep_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_sleep_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;hrv&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;event_profusion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span>
        <span class="n">sleep_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load sleep annotations of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        source : {&quot;hrv&quot;, &quot;event&quot;, &quot;event_profusion&quot;}, default &quot;event&quot;</span>
<span class="sd">            Source of the annotations, case insensitive.</span>
<span class="sd">        sleep_ann_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the sleep annotations.</span>
<span class="sd">            If is None, default path will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df_sleep_ann : pandas.DataFrame or dict</span>
<span class="sd">            All sleep annotations of the record.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;hrv&quot;</span><span class="p">:</span>
            <span class="n">df_hrv_ann</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_hrv_detailed_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">hrv_ann_path</span><span class="o">=</span><span class="n">sleep_ann_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">df_hrv_ann</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">df_sleep_ann</span> <span class="o">=</span> <span class="n">df_hrv_ann</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_ann_keys_from_hrv</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df_sleep_ann</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_ann_keys_from_hrv</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;record `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` has `</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sleep_ann</span><span class="p">)</span><span class="si">}</span><span class="s2">` sleep annotations from corresponding &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;hrv-5min (detailed) annotation file, with `</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_ann_keys_from_hrv</span><span class="p">)</span><span class="si">}</span><span class="s2">` column(s)&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;event&quot;</span><span class="p">:</span>
            <span class="n">df_event_ann</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_event_ann</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">event_ann_path</span><span class="o">=</span><span class="n">sleep_ann_path</span><span class="p">,</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;EventType&quot;</span><span class="p">,</span> <span class="s2">&quot;EventConcept&quot;</span><span class="p">,</span> <span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;Duration&quot;</span><span class="p">,</span> <span class="s2">&quot;SignalLocation&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">df_event_ann</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">df_sleep_ann</span> <span class="o">=</span> <span class="n">df_event_ann</span><span class="p">[</span><span class="n">_cols</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df_sleep_ann</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">_cols</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;record `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` has `</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sleep_ann</span><span class="p">)</span><span class="si">}</span><span class="s2">` sleep annotations from corresponding &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;event-nsrr annotation file, with `</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">` column(s)&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;event_profusion&quot;</span><span class="p">:</span>
            <span class="n">dict_event_ann</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_event_profusion_ann</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
            <span class="c1"># temporarily finished</span>
            <span class="c1"># latter to make imporvements</span>
            <span class="n">df_sleep_ann</span> <span class="o">=</span> <span class="n">dict_event_ann</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;record `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` has `</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sleep_ann</span><span class="p">[</span><span class="s1">&#39;df_events&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">` sleep event annotations &quot;</span>
                <span class="s2">&quot;from corresponding event-profusion annotation file, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;with `</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sleep_ann</span><span class="p">[</span><span class="s1">&#39;df_events&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">` column(s)&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source `</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">` not supported, &quot;</span> <span class="s2">&quot;only `hrv`, `event`, `event_profusion` are supported&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_sleep_ann</span></div>


<div class="viewcode-block" id="SHHS.load_sleep_stage_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_sleep_stage_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_sleep_stage_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;hrv&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;event_profusion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span>
        <span class="n">sleep_stage_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sleep_stage_protocol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;aasm&quot;</span><span class="p">,</span>
        <span class="n">with_stage_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load sleep stage annotations of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        source : {&quot;hrv&quot;, &quot;event&quot;, &quot;event_profusion&quot;}, default &quot;event&quot;</span>
<span class="sd">            Source of the annotations, case insensitive.</span>
<span class="sd">        sleep_stage_ann_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the sleep stage annotations.</span>
<span class="sd">            If is None, default path will be used.</span>
<span class="sd">        sleep_stage_protocol : str, default &quot;aasm&quot;</span>
<span class="sd">            The protocol to classify sleep stages.</span>
<span class="sd">            Currently can be &quot;aasm&quot;, &quot;simplified&quot;, &quot;shhs&quot;.</span>
<span class="sd">            The only difference lies in the number of different stages of the NREM periods.</span>
<span class="sd">        with_stage_names : bool, default True</span>
<span class="sd">            If True, an additional column &quot;sleep_stage_name&quot;</span>
<span class="sd">            will be added to the returned :class:`~pandas.DataFrame`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df_sleep_stage_ann : pandas.DataFrame</span>
<span class="sd">            Sleep stage annotations of the record.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_protocol</span> <span class="o">=</span> <span class="n">sleep_stage_protocol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sleep_stage_names</span><span class="p">()</span>

        <span class="n">df_sleep_ann</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sleep_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">sleep_ann_path</span><span class="o">=</span><span class="n">sleep_stage_ann_path</span><span class="p">)</span>

        <span class="n">df_sleep_stage_ann</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_keys</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;hrv&quot;</span><span class="p">:</span>
            <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">df_sleep_ann</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_ann_keys_from_hrv</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_tmp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">start_sec</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Start__sec_&quot;</span><span class="p">]</span>
                <span class="n">l_start_sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                    <span class="n">start_sec</span><span class="p">,</span>
                    <span class="n">start_sec</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrv_ann_epoch_len_sec</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sleep_epoch_len_sec</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">l_sleep_stage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_ann_keys_from_hrv</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                            <span class="mi">1</span><span class="p">,</span>
                            <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrv_ann_epoch_len_sec</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_epoch_len_sec</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">df_to_concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;start_sec&quot;</span><span class="p">:</span> <span class="n">l_start_sec</span><span class="p">,</span> <span class="s2">&quot;sleep_stage&quot;</span><span class="p">:</span> <span class="n">l_sleep_stage</span><span class="p">})</span>
                <span class="n">df_sleep_stage_ann</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sleep_stage_ann</span><span class="p">,</span> <span class="n">df_to_concat</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;event&quot;</span><span class="p">:</span>
            <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">df_sleep_ann</span><span class="p">[</span><span class="n">df_sleep_ann</span><span class="p">[</span><span class="s2">&quot;EventType&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Stages|Stages&quot;</span><span class="p">][</span>
                <span class="p">[</span><span class="s2">&quot;EventConcept&quot;</span><span class="p">,</span> <span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;Duration&quot;</span><span class="p">]</span>
            <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;EventConcept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;EventConcept&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_tmp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">start_sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Start&quot;</span><span class="p">])</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Duration&quot;</span><span class="p">])</span>
                <span class="n">l_start_sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start_sec</span><span class="p">,</span> <span class="n">start_sec</span> <span class="o">+</span> <span class="n">duration</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_epoch_len_sec</span><span class="p">)</span>
                <span class="n">l_sleep_stage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">l_start_sec</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;EventConcept&quot;</span><span class="p">]))</span>
                <span class="n">df_to_concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;start_sec&quot;</span><span class="p">:</span> <span class="n">l_start_sec</span><span class="p">,</span> <span class="s2">&quot;sleep_stage&quot;</span><span class="p">:</span> <span class="n">l_sleep_stage</span><span class="p">})</span>
                <span class="n">df_sleep_stage_ann</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sleep_stage_ann</span><span class="p">,</span> <span class="n">df_to_concat</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;event_profusion&quot;</span><span class="p">:</span>
            <span class="n">df_sleep_stage_ann</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;start_sec&quot;</span><span class="p">:</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sleep_ann</span><span class="p">[</span><span class="s2">&quot;sleep_stage_list&quot;</span><span class="p">])),</span>
                    <span class="s2">&quot;sleep_stage&quot;</span><span class="p">:</span> <span class="n">df_sleep_ann</span><span class="p">[</span><span class="s2">&quot;sleep_stage_list&quot;</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source `</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">` not supported, &quot;</span> <span class="s2">&quot;only `hrv`, `event`, `event_profusion` are supported&quot;</span><span class="p">)</span>

        <span class="n">df_sleep_stage_ann</span> <span class="o">=</span> <span class="n">df_sleep_stage_ann</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_keys</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_protocol</span> <span class="o">==</span> <span class="s2">&quot;aasm&quot;</span><span class="p">:</span>
            <span class="n">df_sleep_stage_ann</span><span class="p">[</span><span class="s2">&quot;sleep_stage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sleep_stage_ann</span><span class="p">[</span><span class="s2">&quot;sleep_stage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_aasm_states</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_protocol</span> <span class="o">==</span> <span class="s2">&quot;simplified&quot;</span><span class="p">:</span>
            <span class="n">df_sleep_stage_ann</span><span class="p">[</span><span class="s2">&quot;sleep_stage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sleep_stage_ann</span><span class="p">[</span><span class="s2">&quot;sleep_stage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_simplified_states</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_protocol</span> <span class="o">==</span> <span class="s2">&quot;shhs&quot;</span><span class="p">:</span>
            <span class="n">df_sleep_stage_ann</span><span class="p">[</span><span class="s2">&quot;sleep_stage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sleep_stage_ann</span><span class="p">[</span><span class="s2">&quot;sleep_stage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_shhs_states</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">with_stage_names</span><span class="p">:</span>
            <span class="n">df_sleep_stage_ann</span><span class="p">[</span><span class="s2">&quot;sleep_stage_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sleep_stage_ann</span><span class="p">[</span><span class="s2">&quot;sleep_stage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_names</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;event_profusion&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;record `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` has `</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">)</span><span class="si">}</span><span class="s2">` raw (epoch_len = 5min) sleep stage annotations, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;with `</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_ann_keys_from_hrv</span><span class="p">)</span><span class="si">}</span><span class="s2">` column(s)&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;after being transformed (epoch_len = 30sec), record `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sleep_stage_ann</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;sleep stage annotations, with `</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">` column(s)&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">df_sleep_stage_ann</span></div>


<div class="viewcode-block" id="SHHS.load_sleep_event_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_sleep_event_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_sleep_event_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;hrv&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;event_profusion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span>
        <span class="n">event_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sleep_event_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load sleep event annotations of a record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        source : {&quot;hrv&quot;, &quot;event&quot;, &quot;event_profusion&quot;}, default &quot;event&quot;</span>
<span class="sd">            Source of the annotations, case insensitive.</span>
<span class="sd">        event_types : List[str], optional</span>
<span class="sd">            List of event types to be loaded, by default None.</span>
<span class="sd">            The event types are:</span>
<span class="sd">            &quot;Respiratory&quot; (including &quot;Apnea&quot;, &quot;SpO2&quot;), &quot;Arousal&quot;,</span>
<span class="sd">            &quot;Apnea&quot; (including &quot;CSA&quot;, &quot;OSA&quot;, &quot;MSA&quot;, &quot;Hypopnea&quot;), &quot;SpO2&quot;,</span>
<span class="sd">            &quot;CSA&quot;, &quot;OSA&quot;, &quot;MSA&quot;, &quot;Hypopnea&quot;.</span>
<span class="sd">            Used only when `source` is &quot;event&quot; or &quot;event_profusion&quot;.</span>
<span class="sd">        sleep_event_ann_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the sleep event annotations.</span>
<span class="sd">            If is None, default path will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df_sleep_event_ann : pandas.DataFrame</span>
<span class="sd">            Sleep event annotations of the record.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>
        <span class="n">df_sleep_ann</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sleep_ann</span><span class="p">(</span><span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">sleep_ann_path</span><span class="o">=</span><span class="n">sleep_event_ann_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_sleep_ann</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">df_sleep_ann</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df_sleep_ann</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_sleep_ann</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">df_sleep_ann</span><span class="p">[</span><span class="s2">&quot;df_events&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df_sleep_ann</span><span class="p">[</span><span class="s2">&quot;df_events&quot;</span><span class="p">]</span>

        <span class="n">df_sleep_event_ann</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_event_keys</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;hrv&quot;</span><span class="p">:</span>
            <span class="n">df_sleep_ann</span> <span class="o">=</span> <span class="n">df_sleep_ann</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_event_ann_keys_from_hrv</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">df_sleep_event_ann</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_event_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_sleep_ann</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;hasrespevent&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">l_events</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_event_ann_keys_from_hrv</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_event_ann_keys_from_hrv</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">l_events</span> <span class="o">=</span> <span class="n">l_events</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">l_events</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])]</span>
                <span class="n">df_to_concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">l_events</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_event_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">df_sleep_event_ann</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sleep_event_ann</span><span class="p">,</span> <span class="n">df_to_concat</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">df_sleep_event_ann</span><span class="p">[</span><span class="s2">&quot;event_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">df_sleep_event_ann</span><span class="p">[</span><span class="s2">&quot;event_duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sleep_event_ann</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;event_end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;event_start&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">df_sleep_event_ann</span> <span class="o">=</span> <span class="n">df_sleep_event_ann</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_event_keys</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;record `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` has `</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sleep_ann</span><span class="p">)</span><span class="si">}</span><span class="s2">` raw (epoch_len = 5min) sleep event &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;annotations from hrv, with `</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_event_ann_keys_from_hrv</span><span class="p">)</span><span class="si">}</span><span class="s2">` column(s)&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after being transformed, record `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` has `</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sleep_event_ann</span><span class="p">)</span><span class="si">}</span><span class="s2">` sleep event(s)&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;event&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">event_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;respiratory&quot;</span><span class="p">,</span> <span class="s2">&quot;arousal&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">event_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">]</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">set</span><span class="p">()</span>
                <span class="o">&lt;</span> <span class="nb">set</span><span class="p">(</span><span class="n">event_types</span><span class="p">)</span>
                <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;respiratory&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;arousal&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;apnea&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;spo2&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;csa&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;osa&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;msa&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;hypopnea&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">),</span> <span class="p">(</span>
                <span class="s2">&quot;`event_types` should be a subset of &quot;</span>
                <span class="s2">&quot;&#39;respiratory&#39;, &#39;arousal&#39;, &#39;apnea&#39;, &#39;spo2&#39;, &#39;csa&#39;, &#39;osa&#39;, &#39;msa&#39;, &#39;hypopnea&#39;&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;but got `</span><span class="si">{</span><span class="n">event_types</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;respiratory&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">long_event_names_from_event</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;arousal&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">long_event_names_from_event</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">11</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;apnea&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">long_event_names_from_event</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;spo2&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">long_event_names_from_event</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;csa&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">long_event_names_from_event</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;osa&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">long_event_names_from_event</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;msa&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">long_event_names_from_event</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;hypopnea&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">long_event_names_from_event</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_cols</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;for record `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">`, _cols = `</span><span class="si">{</span><span class="n">_cols</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>

            <span class="n">df_sleep_event_ann</span> <span class="o">=</span> <span class="n">df_sleep_ann</span><span class="p">[</span><span class="n">df_sleep_ann</span><span class="p">[</span><span class="s2">&quot;EventConcept&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">_cols</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">df_sleep_event_ann</span> <span class="o">=</span> <span class="n">df_sleep_event_ann</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;EventConcept&quot;</span><span class="p">:</span> <span class="s2">&quot;event_name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Start&quot;</span><span class="p">:</span> <span class="s2">&quot;event_start&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Duration&quot;</span><span class="p">:</span> <span class="s2">&quot;event_duration&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">df_sleep_event_ann</span><span class="p">[</span><span class="s2">&quot;event_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sleep_event_ann</span><span class="p">[</span><span class="s2">&quot;event_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">df_sleep_event_ann</span><span class="p">[</span><span class="s2">&quot;event_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sleep_event_ann</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;event_start&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;event_duration&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">df_sleep_event_ann</span> <span class="o">=</span> <span class="n">df_sleep_event_ann</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_event_keys</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;event_profusion&quot;</span><span class="p">:</span>
            <span class="n">df_sleep_ann</span> <span class="o">=</span> <span class="n">df_sleep_ann</span><span class="p">[</span><span class="s2">&quot;df_events&quot;</span><span class="p">]</span>
            <span class="n">_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">event_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">event_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;respiratory&quot;</span><span class="p">,</span> <span class="s2">&quot;arousal&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">event_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">]</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">set</span><span class="p">()</span>
                <span class="o">&lt;</span> <span class="nb">set</span><span class="p">(</span><span class="n">event_types</span><span class="p">)</span>
                <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;respiratory&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;arousal&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;apnea&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;spo2&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;csa&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;osa&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;msa&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;hypopnea&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">),</span> <span class="p">(</span>
                <span class="s2">&quot;`event_types` should be a subset of &quot;</span>
                <span class="s2">&quot;&#39;respiratory&#39;, &#39;arousal&#39;, &#39;apnea&#39;, &#39;spo2&#39;, &#39;csa&#39;, &#39;osa&#39;, &#39;msa&#39;, &#39;hypopnea&#39;, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;but got `</span><span class="si">{</span><span class="n">event_types</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;respiratory&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_names_from_event_profusion</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;arousal&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_names_from_event_profusion</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;apnea&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_names_from_event_profusion</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;spo2&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_names_from_event_profusion</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;csa&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_names_from_event_profusion</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;osa&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_names_from_event_profusion</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;msa&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_names_from_event_profusion</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;hypopnea&quot;</span> <span class="ow">in</span> <span class="n">event_types</span><span class="p">:</span>
                <span class="n">_cols</span> <span class="o">=</span> <span class="n">_cols</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_names_from_event_profusion</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_cols</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;for record `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">`, _cols = `</span><span class="si">{</span><span class="n">_cols</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>

            <span class="n">df_sleep_event_ann</span> <span class="o">=</span> <span class="n">df_sleep_ann</span><span class="p">[</span><span class="n">df_sleep_ann</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">_cols</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">df_sleep_event_ann</span> <span class="o">=</span> <span class="n">df_sleep_event_ann</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;event_name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Start&quot;</span><span class="p">:</span> <span class="s2">&quot;event_start&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Duration&quot;</span><span class="p">:</span> <span class="s2">&quot;event_duration&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">df_sleep_event_ann</span><span class="p">[</span><span class="s2">&quot;event_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sleep_event_ann</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;event_start&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;event_duration&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">df_sleep_event_ann</span> <span class="o">=</span> <span class="n">df_sleep_event_ann</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_event_keys</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source `</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">` not supported, &quot;</span> <span class="s2">&quot;only `hrv`, `event`, `event_profusion` are supported&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df_sleep_event_ann</span></div>


<div class="viewcode-block" id="SHHS.load_apnea_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_apnea_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_apnea_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;event_profusion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span>
        <span class="n">apnea_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">apnea_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load annotations on apnea events of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        source : {&quot;event&quot;, &quot;event_profusion&quot;}, default &quot;event&quot;</span>
<span class="sd">            Source of the annotations, case insensitive.</span>
<span class="sd">        apnea_types : List[str], optional</span>
<span class="sd">            Types of apnea events to load, should be a subset of</span>
<span class="sd">            &quot;CSA&quot;, &quot;OSA&quot;, &quot;MSA&quot;, &quot;Hypopnea&quot;.</span>
<span class="sd">            If is None, then all types of apnea will be loaded.</span>
<span class="sd">        apnea_ann_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains the apnea event annotations.</span>
<span class="sd">            If is None, default path will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df_apnea_ann : pandas.DataFrame</span>
<span class="sd">            Apnea event annotations of the record.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;apnea&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">apnea_types</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">apnea_types</span>
        <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;event_profusion&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source `</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">` contains no apnea annotations, &quot;</span> <span class="s2">&quot;should be one of &#39;event&#39;, &#39;event_profusion&#39;&quot;</span><span class="p">)</span>
        <span class="n">df_apnea_ann</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sleep_event_ann</span><span class="p">(</span>
            <span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
            <span class="n">event_types</span><span class="o">=</span><span class="n">event_types</span><span class="p">,</span>
            <span class="n">sleep_event_ann_path</span><span class="o">=</span><span class="n">apnea_ann_path</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df_apnea_ann</span></div>


<div class="viewcode-block" id="SHHS.load_wave_delineation_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_wave_delineation_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_wave_delineation_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">wave_deli_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load annotations on wave delineations of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        wave_deli_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains wave delineation annotations.</span>
<span class="sd">            If is None, default path will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df_wave_delineation : pandas.DataFrame</span>
<span class="sd">            Wave delineation annotations of the record.</span>

<span class="sd">        NOTE</span>
<span class="sd">        ----</span>
<span class="sd">        See the part describing wave delineation annotations of the docstring of the class,</span>
<span class="sd">        or call ``self.database_info(detailed=True)``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>

        <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_absolute_path</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">wave_deli_path</span><span class="p">,</span> <span class="n">rec_type</span><span class="o">=</span><span class="s2">&quot;wave_delineation&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The annotation file of wave delineation of record `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` has not been downloaded yet. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Or the path `</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="si">}</span><span class="s2">` is not correct. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Or `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` does not have `rpeak.csv` annotation file. Please check!&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">df_wave_delineation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
        <span class="n">df_wave_delineation</span> <span class="o">=</span> <span class="n">df_wave_delineation</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_deli_keys</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_wave_delineation</span></div>


<div class="viewcode-block" id="SHHS.load_rpeak_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_rpeak_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_rpeak_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">rpeak_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude_artifacts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">exclude_abnormal_beats</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">units</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load annotations on R peaks of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        rpeak_ann_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains R peak annotations.</span>
<span class="sd">            If is None, default path will be used.</span>
<span class="sd">        exclude_artifacts : bool, default True</span>
<span class="sd">            Whether exlcude those beats (R peaks) that are labelled artifact or not.</span>
<span class="sd">        exclude_abnormal_beats : bool, default True</span>
<span class="sd">            Whether exlcude those beats (R peaks) that are</span>
<span class="sd">            labelled abnormal (&quot;VE&quot; and &quot;SVE&quot;) or not.</span>
<span class="sd">        units : {None, &quot;s&quot;, &quot;ms&quot;}, optional</span>
<span class="sd">            Units of the returned R peak locations, case insensitive.</span>
<span class="sd">            None for no conversion, using indices of samples.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            Locations of R peaks of the record,</span>
<span class="sd">            of shape ``(n_rpeaks, )``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info_items</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;rpointadj&quot;</span><span class="p">,</span> <span class="s2">&quot;samplingrate&quot;</span><span class="p">]</span>
        <span class="n">df_rpeaks_with_type_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_wave_delineation_ann</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">rpeak_ann_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_rpeaks_with_type_info</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">df_rpeaks_with_type_info</span> <span class="o">=</span> <span class="n">df_rpeaks_with_type_info</span><span class="p">[</span><span class="n">info_items</span><span class="p">]</span>
        <span class="n">exclude_beat_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># 0 = Artifact, 1 = Normal Sinus Beat, 2 = VE, 3 = SVE</span>
        <span class="k">if</span> <span class="n">exclude_artifacts</span><span class="p">:</span>
            <span class="n">exclude_beat_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exclude_abnormal_beats</span><span class="p">:</span>
            <span class="n">exclude_beat_types</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

        <span class="n">rpeaks</span> <span class="o">=</span> <span class="n">df_rpeaks_with_type_info</span><span class="p">[</span><span class="o">~</span><span class="n">df_rpeaks_with_type_info</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude_beat_types</span><span class="p">)][</span><span class="s2">&quot;rpointadj&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rpeaks</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rpeaks</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">df_rpeaks_with_type_info</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;samplingrate&quot;</span><span class="p">]</span>
            <span class="n">rpeaks</span> <span class="o">=</span> <span class="n">rpeaks</span> <span class="o">/</span> <span class="n">fs</span>
        <span class="k">elif</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ms&quot;</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">df_rpeaks_with_type_info</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;samplingrate&quot;</span><span class="p">]</span>
            <span class="n">rpeaks</span> <span class="o">=</span> <span class="n">rpeaks</span> <span class="o">/</span> <span class="n">fs</span> <span class="o">*</span> <span class="mi">1000</span>
            <span class="n">rpeaks</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rpeaks</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`units` should be one of &#39;s&#39;, &#39;ms&#39;, case insensitive, &quot;</span>
                <span class="s2">&quot;or None for no conversion, using indices of samples, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;but got `</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">rpeaks</span></div>


<div class="viewcode-block" id="SHHS.load_rr_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_rr_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_rr_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">rpeak_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">units</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load annotations on RR intervals of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        rpeak_ann_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains R peak annotations.</span>
<span class="sd">            If is None, default path will be used.</span>
<span class="sd">        units : {None, &quot;s&quot;, &quot;ms&quot;}, optional</span>
<span class="sd">            units of the returned R peak locations,</span>
<span class="sd">            by default &quot;s&quot;, case insensitive.</span>
<span class="sd">            None for no conversion, using indices of samples.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rr : numpy.ndarray.</span>
<span class="sd">            Array of RR intervals, of shape ``(n_rpeaks - 1, 2)``.</span>
<span class="sd">            Each row is a RR interval, and</span>
<span class="sd">            the first column is the location of the R peak.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rpeaks_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_rpeak_ann</span><span class="p">(</span>
            <span class="n">rec</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span>
            <span class="n">rpeak_ann_path</span><span class="o">=</span><span class="n">rpeak_ann_path</span><span class="p">,</span>
            <span class="n">exclude_artifacts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">exclude_abnormal_beats</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">rpeaks_ts</span><span class="p">)</span>
        <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">rpeaks_ts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rr</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rr</span></div>


<div class="viewcode-block" id="SHHS.load_nn_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_nn_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_nn_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">rpeak_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">units</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load annotations on NN intervals of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        rpeak_ann_path: os.PathLike, optional</span>
<span class="sd">            Path of the file which contains R peak annotations.</span>
<span class="sd">            If is None, default path will be used.</span>
<span class="sd">        units: {None, &quot;s&quot;, &quot;ms&quot;}, optional</span>
<span class="sd">            Units of the returned R peak locations,</span>
<span class="sd">            by default &quot;s&quot;, case insensitive.</span>
<span class="sd">            None for no conversion, using indices of samples.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nn : numpy.ndarray</span>
<span class="sd">            Array of nn intervals, of shape (n, 2).</span>
<span class="sd">            Each row is a nn interval, and</span>
<span class="sd">            the first column is the location of the R peak.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info_items</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;rpointadj&quot;</span><span class="p">,</span> <span class="s2">&quot;samplingrate&quot;</span><span class="p">]</span>
        <span class="n">df_rpeaks_with_type_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_wave_delineation_ann</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">rpeak_ann_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_rpeaks_with_type_info</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">df_rpeaks_with_type_info</span> <span class="o">=</span> <span class="n">df_rpeaks_with_type_info</span><span class="p">[</span><span class="n">info_items</span><span class="p">]</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">df_rpeaks_with_type_info</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;samplingrate&quot;</span><span class="p">]</span>
        <span class="n">rpeaks</span> <span class="o">=</span> <span class="n">df_rpeaks_with_type_info</span><span class="p">[</span><span class="s2">&quot;rpointadj&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rpeaks</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rpeaks</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
            <span class="n">rpeaks</span> <span class="o">=</span> <span class="n">rpeaks</span> <span class="o">/</span> <span class="n">fs</span>
        <span class="k">elif</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ms&quot;</span><span class="p">:</span>
            <span class="n">rpeaks</span> <span class="o">=</span> <span class="n">rpeaks</span> <span class="o">/</span> <span class="n">fs</span> <span class="o">*</span> <span class="mi">1000</span>
            <span class="n">rpeaks</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rpeaks</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`units` should be one of &#39;s&#39;, &#39;ms&#39;, case insensitive, &quot;</span>
                <span class="s2">&quot;or None for no conversion, using indices of samples, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;but got `</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span>

        <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">rpeaks</span><span class="p">)</span>
        <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">rpeaks</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rr</span><span class="p">))</span>

        <span class="n">normal_sinus_rpeak_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df_rpeaks_with_type_info</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 1 = Normal Sinus Beat</span>
        <span class="n">keep_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">normal_sinus_rpeak_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="n">rr</span><span class="p">[</span><span class="n">normal_sinus_rpeak_indices</span><span class="p">[</span><span class="n">keep_indices</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="SHHS.locate_artifacts">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.locate_artifacts">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">locate_artifacts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">wave_deli_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">units</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Locate &quot;artifacts&quot; in the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        wave_deli_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains wave delineation annotations.</span>
<span class="sd">            If is None, default path will be used.</span>
<span class="sd">        units : {None, &quot;s&quot;, &quot;ms&quot;}, optional</span>
<span class="sd">            Units of the returned artifact locations,</span>
<span class="sd">            can be one of &quot;s&quot;, &quot;ms&quot;, case insensitive,</span>
<span class="sd">            None for no conversion, using indices of samples.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        artifacts : numpy.ndarray</span>
<span class="sd">            Array of indices (or time) of artifacts locations,</span>
<span class="sd">            of shape ``(n_artifacts,)``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df_rpeaks_with_type_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_wave_delineation_ann</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">wave_deli_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_rpeaks_with_type_info</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span> <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;s&quot;</span> <span class="k">else</span> <span class="nb">float</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="c1"># df_rpeaks_with_type_info = df_rpeaks_with_type_info[[&quot;Type&quot;, &quot;rpointadj&quot;]]</span>

        <span class="n">artifacts</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">df_rpeaks_with_type_info</span><span class="p">[</span><span class="n">df_rpeaks_with_type_info</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s2">&quot;rpointadj&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">df_rpeaks_with_type_info</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;samplingrate&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
                <span class="n">artifacts</span> <span class="o">=</span> <span class="n">artifacts</span> <span class="o">/</span> <span class="n">fs</span>
            <span class="k">elif</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ms&quot;</span><span class="p">:</span>
                <span class="n">artifacts</span> <span class="o">=</span> <span class="n">artifacts</span> <span class="o">/</span> <span class="n">fs</span> <span class="o">*</span> <span class="mi">1000</span>
                <span class="n">artifacts</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">artifacts</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`units` should be one of &#39;s&#39;, &#39;ms&#39;, case insensitive, &quot;</span>
                    <span class="s2">&quot;or None for no conversion, using indices of samples, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;but got `</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">artifacts</span></div>


<div class="viewcode-block" id="SHHS.locate_abnormal_beats">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.locate_abnormal_beats">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">locate_abnormal_beats</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">wave_deli_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">abnormal_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;VE&quot;</span><span class="p">,</span> <span class="s2">&quot;SVE&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">units</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Locate &quot;abnormal beats&quot; in the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        wave_deli_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains wave delineation annotations.</span>
<span class="sd">            If is None, default path will be used.</span>
<span class="sd">        abnormal_type : {&quot;VE&quot;, &quot;SVE&quot;}, optional</span>
<span class="sd">            Type of abnormal beat type to locate.</span>
<span class="sd">            If is None, both &quot;VE&quot; and &quot;SVE&quot; will be located.</span>
<span class="sd">        units : {None, &quot;s&quot;, &quot;ms&quot;}, optional</span>
<span class="sd">            Units of the returned R peak locations,</span>
<span class="sd">            by default None, case insensitive.</span>
<span class="sd">            None for no conversion, using indices of samples.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        abnormal_rpeaks : dict or numpy.ndarray</span>
<span class="sd">            If `abnormal_type` is None,</span>
<span class="sd">            return a dictionary of abnormal beat locations,</span>
<span class="sd">            which contains two keys &quot;VE&quot; and/or &quot;SVE&quot;, and</span>
<span class="sd">            values are indices (or time) of abnormal beats,</span>
<span class="sd">            of shape ``(n,)``.</span>
<span class="sd">            If `abnormal_type` is not None,</span>
<span class="sd">            return a :class:`~numpy.ndarray` of abnormal beat locations,</span>
<span class="sd">            of shape ``(n,)``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">abnormal_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">abnormal_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;VE&quot;</span><span class="p">,</span> <span class="s2">&quot;SVE&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No abnormal type of `</span><span class="si">{</span><span class="n">abnormal_type</span><span class="si">}</span><span class="s2">` in &quot;</span> <span class="s2">&quot;wave delineation annotation (*-rpeak.csv) files&quot;</span><span class="p">)</span>

        <span class="n">df_rpeaks_with_type_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_wave_delineation_ann</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">wave_deli_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df_rpeaks_with_type_info</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># df_rpeaks_with_type_info = df_rpeaks_with_type_info[[&quot;Type&quot;, &quot;rpointadj&quot;]]</span>
            <span class="c1"># 2 = VE, 3 = SVE</span>
            <span class="n">ve</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">df_rpeaks_with_type_info</span><span class="p">[</span><span class="n">df_rpeaks_with_type_info</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">][</span><span class="s2">&quot;rpointadj&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">sve</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">df_rpeaks_with_type_info</span><span class="p">[</span><span class="n">df_rpeaks_with_type_info</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">][</span><span class="s2">&quot;rpointadj&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">abnormal_rpeaks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;VE&quot;</span><span class="p">:</span> <span class="n">ve</span><span class="p">,</span> <span class="s2">&quot;SVE&quot;</span><span class="p">:</span> <span class="n">sve</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span> <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;s&quot;</span> <span class="k">else</span> <span class="nb">float</span>
            <span class="n">abnormal_rpeaks</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;VE&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">),</span>
                <span class="s2">&quot;SVE&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">),</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">df_rpeaks_with_type_info</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">df_rpeaks_with_type_info</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;samplingrate&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
                <span class="n">abnormal_rpeaks</span> <span class="o">=</span> <span class="p">{</span><span class="n">abnormal_type</span><span class="p">:</span> <span class="n">abnormal_rpeaks</span><span class="p">[</span><span class="n">abnormal_type</span><span class="p">]</span> <span class="o">/</span> <span class="n">fs</span> <span class="k">for</span> <span class="n">abnormal_type</span> <span class="ow">in</span> <span class="n">abnormal_rpeaks</span><span class="p">}</span>
            <span class="k">elif</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ms&quot;</span><span class="p">:</span>
                <span class="n">abnormal_rpeaks</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">abnormal_type</span><span class="p">:</span> <span class="n">abnormal_rpeaks</span><span class="p">[</span><span class="n">abnormal_type</span><span class="p">]</span> <span class="o">/</span> <span class="n">fs</span> <span class="o">*</span> <span class="mi">1000</span> <span class="k">for</span> <span class="n">abnormal_type</span> <span class="ow">in</span> <span class="n">abnormal_rpeaks</span>
                <span class="p">}</span>
                <span class="n">abnormal_rpeaks</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">abnormal_type</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">abnormal_rpeaks</span><span class="p">[</span><span class="n">abnormal_type</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">abnormal_type</span> <span class="ow">in</span> <span class="n">abnormal_rpeaks</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`units` should be one of &#39;s&#39;, &#39;ms&#39;, case insensitive, &quot;</span>
                    <span class="s2">&quot;or None for no conversion, using indices of samples, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;but got `</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">abnormal_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">abnormal_rpeaks</span>
        <span class="k">elif</span> <span class="n">abnormal_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;VE&quot;</span><span class="p">,</span> <span class="s2">&quot;SVE&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">abnormal_rpeaks</span><span class="p">[</span><span class="n">abnormal_type</span><span class="p">]</span></div>


<div class="viewcode-block" id="SHHS.load_eeg_band_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_eeg_band_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_eeg_band_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">eeg_band_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load annotations on EEG bands of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        eeg_band_ann_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains EEG band annotations.</span>
<span class="sd">            if is None, default path will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            A :class:`~pandas.DataFrame` of EEG band annotations.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_version</span> <span class="o">&gt;=</span> <span class="s2">&quot;0.15.0&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EEG spectral summary variables are removed in version </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="SHHS.load_eeg_spectral_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.load_eeg_spectral_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_eeg_spectral_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">eeg_spectral_ann_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load annotations on EEG spectral summary of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        eeg_spectral_ann_path : `path-like`, optional</span>
<span class="sd">            Path of the file which contains EEG spectral summary annotations.</span>
<span class="sd">            If is None, default path will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            A :class:`~pandas.DataFrame` of EEG spectral summary annotations.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_version</span> <span class="o">&gt;=</span> <span class="s2">&quot;0.15.0&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EEG spectral summary variables are removed in version </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


    <span class="c1"># TODO: add more functions for annotation reading</span>
    <span class="c1"># TODO: add plotting functions</span>

<div class="viewcode-block" id="SHHS.plot_ann">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.plot_ann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">stage_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;hrv&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;event_profusion&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stage_kw</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">event_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;hrv&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;event_profusion&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">event_kw</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">plot_format</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="s2">&quot;hypnogram&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;span&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot annotations of the record.</span>

<span class="sd">        Plot the sleep stage annotations</span>
<span class="sd">        and sleep event annotations of the record.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str or int</span>
<span class="sd">            Record name, typically in the form &quot;shhs1-200001&quot;,</span>
<span class="sd">            or index of the record in :attr:`all_records`.</span>
<span class="sd">        stage_source : {&quot;hrv&quot;, &quot;event&quot;, &quot;event_profusion&quot;}, optional</span>
<span class="sd">            Source of the sleep stage annotations, case in-sensitive.</span>
<span class="sd">            If is None, then annotations of sleep stages of `rec` won&#39;t be plotted.</span>
<span class="sd">        stage_kw : dict, optional</span>
<span class="sd">            Key word arguments to the function :meth:`load_sleep_stage_ann`.</span>
<span class="sd">        event_source : {&quot;hrv&quot;, &quot;event&quot;, &quot;event_profusion&quot;}, optional</span>
<span class="sd">            Source of the sleep event annotations, case in-sensitive.</span>
<span class="sd">            If is None, then annotations of sleep events of `rec` won&#39;t be plotted.</span>
<span class="sd">        event_kw : dict, optional</span>
<span class="sd">            Key word arguments to the function :meth:`load_sleep_event_ann`.</span>
<span class="sd">        plot_format : {&quot;span&quot;, &quot;hypnogram&quot;}, default &quot;span&quot;</span>
<span class="sd">            Format of the plot, case insensitive.</span>

<span class="sd">        TODO</span>
<span class="sd">        ----</span>
<span class="sd">        1. ~~Implement the &quot;hypnogram&quot; format.~~</span>
<span class="sd">        2. Implement plotting of sleep events.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">stage_source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">event_source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`stage_source` and `event_source` cannot be both `None`&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">stage_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_sleep_stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sleep_stage_ann</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">stage_source</span><span class="p">,</span> <span class="o">**</span><span class="n">stage_kw</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df_sleep_stage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No sleep stage annotations found for record `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` &quot;</span> <span class="sa">f</span><span class="s2">&quot;with source `</span><span class="si">{</span><span class="n">stage_source</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_sleep_stage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">event_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_sleep_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sleep_event_ann</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">event_source</span><span class="p">,</span> <span class="o">**</span><span class="n">event_kw</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df_sleep_event</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rec</span><span class="p">]</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No sleep event annotations found for record `</span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">` &quot;</span> <span class="sa">f</span><span class="s2">&quot;with source `</span><span class="si">{</span><span class="n">event_source</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_sleep_event</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_ann</span><span class="p">(</span>
            <span class="n">df_sleep_stage</span><span class="o">=</span><span class="n">df_sleep_stage</span><span class="p">,</span>
            <span class="n">df_sleep_event</span><span class="o">=</span><span class="n">df_sleep_event</span><span class="p">,</span>
            <span class="n">plot_format</span><span class="o">=</span><span class="n">plot_format</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_ann</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df_sleep_stage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">df_sleep_event</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plot_format</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="s2">&quot;hypnogram&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;span&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal function to plot annotations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df_sleep_stage : pandas.DataFrame, optional</span>
<span class="sd">            Sleep stage annotations.</span>
<span class="sd">        df_sleep_event : pandas.DataFrame, optional</span>
<span class="sd">            Sleep event annotations.</span>
<span class="sd">        plot_format : {&quot;span&quot;, &quot;hypnogram&quot;}, default &quot;span&quot;</span>
<span class="sd">            Format of the plot, case insensitive.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpatches</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

        <span class="n">check</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_sleep_stage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">df_sleep_event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">nb_axes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nb_axes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No input data!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="s2">&quot;hypnogram&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown plot format `</span><span class="si">{</span><span class="n">plot_format</span><span class="si">}</span><span class="s2">`! &quot;</span> <span class="sa">f</span><span class="s2">&quot;`plot_format` can only be one of `span`, `hypnogram`&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df_sleep_stage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sleep_stages</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_names</span><span class="p">:</span>
                <span class="n">sleep_stages</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">intervals_union</span><span class="p">(</span>
                    <span class="n">interval_list</span><span class="o">=</span><span class="p">[</span>
                        <span class="p">[</span><span class="n">sec</span><span class="p">,</span> <span class="n">sec</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_epoch_len_sec</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span> <span class="n">df_sleep_stage</span><span class="p">[</span><span class="n">df_sleep_stage</span><span class="p">[</span><span class="s2">&quot;sleep_stage&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_name_value_mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span>
                            <span class="s2">&quot;start_sec&quot;</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
                    <span class="p">],</span>
                    <span class="n">join_book_endeds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">df_sleep_event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">current_legal_events</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;Central Apnea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Obstructive Apnea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Mixed Apnea&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Hypopnea&quot;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_legal_events</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">current_legal_events</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_sleep_event</span><span class="p">[</span><span class="s2">&quot;event_name&quot;</span><span class="p">])):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Plotting of some type of events in `df_sleep_event` has not been implemented yet!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;hypnogram&quot;</span><span class="p">:</span>
            <span class="n">stage_mask</span> <span class="o">=</span> <span class="n">df_sleep_stage</span><span class="p">[</span><span class="s2">&quot;sleep_stage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">stage_mask</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_names</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">stage_mask</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_hypnogram</span><span class="p">(</span><span class="n">stage_mask</span><span class="p">,</span> <span class="n">granularity</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">patches</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nb_axes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">nb_axes</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plot_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="n">ax_stages</span><span class="p">,</span> <span class="n">ax_events</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">nb_axes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">df_sleep_stage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax_stages</span> <span class="o">=</span> <span class="n">axes</span>
            <span class="n">ax_stages</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Sleep Stages&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
            <span class="n">ax_stages</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="c1"># ax_stages.set_ylabel(&quot;Stages&quot;, fontsize=16)</span>
        <span class="k">elif</span> <span class="n">nb_axes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">df_sleep_event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax_events</span> <span class="o">=</span> <span class="n">axes</span>
            <span class="n">ax_events</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Sleep Events&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
            <span class="n">ax_events</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="c1"># ax_events.set_ylabel(&quot;Events&quot;, fontsize=16)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_stages</span><span class="p">,</span> <span class="n">ax_events</span> <span class="o">=</span> <span class="n">axes</span>
            <span class="n">ax_stages</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Sleep Stages and Events&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
            <span class="n">ax_events</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ax_stages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sleep_stages</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">itv</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">ax_stages</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span>
                        <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">itv</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">itv</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">plot_alpha</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="n">ax_stages</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">patches</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_sleep_stage_names</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sleep_stages</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
                <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
            <span class="p">)</span>  <span class="c1"># keep ordering</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax_stages</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax_stages</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ax_events</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_sleep_event</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">ax_events</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span>
                    <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;event_start&quot;</span><span class="p">]),</span>
                    <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;event_end&quot;</span><span class="p">]),</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;event_name&quot;</span><span class="p">]],</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">plot_alpha</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">ax_events</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">patches</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">current_legal_events</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_sleep_event</span><span class="p">[</span><span class="s2">&quot;event_name&quot;</span><span class="p">])],</span>
                <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
            <span class="p">)</span>  <span class="c1"># keep ordering</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax_events</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax_events</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="SHHS.str_to_real_number">
<a class="viewcode-back" href="../../../../api/generated/torch_ecg.databases.SHHS.html#torch_ecg.databases.SHHS.str_to_real_number">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">str_to_real_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Real</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Real</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a string to a real number.</span>

<span class="sd">        Some columns in the annotations might incorrectly</span>
<span class="sd">        been converted from numbers.Real to string, using ``xmltodict``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : str or numbers.Real</span>
<span class="sd">            The string to be converted.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numbers.Real</span>
<span class="sd">            The converted number.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># NaN case</span>
            <span class="k">return</span> <span class="n">s</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">__create_constants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create constants for the class.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lazy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lazy&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;psg&quot;</span><span class="p">:</span> <span class="s2">&quot;.edf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wave_delineation&quot;</span><span class="p">:</span> <span class="s2">&quot;-rpoint.csv&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;-nsrr.xml&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event_profusion&quot;</span><span class="p">:</span> <span class="s2">&quot;-profusion.xml&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># fmt: off</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">all_signals</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;EEG(sec)&quot;</span><span class="p">,</span> <span class="s2">&quot;ECG&quot;</span><span class="p">,</span> <span class="s2">&quot;EMG&quot;</span><span class="p">,</span> <span class="s2">&quot;EOG(L)&quot;</span><span class="p">,</span> <span class="s2">&quot;EOG(R)&quot;</span><span class="p">,</span> <span class="s2">&quot;EEG&quot;</span><span class="p">,</span>
            <span class="s2">&quot;AIRFLOW&quot;</span><span class="p">,</span> <span class="s2">&quot;THOR RES&quot;</span><span class="p">,</span> <span class="s2">&quot;ABDO RES&quot;</span><span class="p">,</span> <span class="s2">&quot;NEW AIR&quot;</span><span class="p">,</span> <span class="s2">&quot;OX stat&quot;</span><span class="p">,</span> <span class="s2">&quot;SaO2&quot;</span><span class="p">,</span> <span class="s2">&quot;H.R.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;POSITION&quot;</span><span class="p">,</span> <span class="s2">&quot;SOUND&quot;</span><span class="p">,</span> <span class="s2">&quot;LIGHT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;AUX&quot;</span><span class="p">,</span> <span class="s2">&quot;CPAP&quot;</span><span class="p">,</span> <span class="s2">&quot;EPMS&quot;</span><span class="p">,</span> <span class="s2">&quot;OX STAT&quot;</span><span class="p">,</span> <span class="s2">&quot;PR&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_signals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_signals</span><span class="p">])</span>

        <span class="c1"># annotations regarding sleep analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hrv_ann_summary_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;nsrrid&quot;</span><span class="p">,</span> <span class="s2">&quot;visitnumber&quot;</span><span class="p">,</span> <span class="s2">&quot;NN_RR&quot;</span><span class="p">,</span> <span class="s2">&quot;AVNN&quot;</span><span class="p">,</span> <span class="s2">&quot;IHR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SDNN&quot;</span><span class="p">,</span> <span class="s2">&quot;SDANN&quot;</span><span class="p">,</span> <span class="s2">&quot;SDNNIDX&quot;</span><span class="p">,</span> <span class="s2">&quot;rMSSD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pNN10&quot;</span><span class="p">,</span> <span class="s2">&quot;pNN20&quot;</span><span class="p">,</span> <span class="s2">&quot;pNN30&quot;</span><span class="p">,</span> <span class="s2">&quot;pNN40&quot;</span><span class="p">,</span> <span class="s2">&quot;pNN50&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tot_pwr&quot;</span><span class="p">,</span> <span class="s2">&quot;ULF&quot;</span><span class="p">,</span> <span class="s2">&quot;VLF&quot;</span><span class="p">,</span> <span class="s2">&quot;LF&quot;</span><span class="p">,</span> <span class="s2">&quot;HF&quot;</span><span class="p">,</span> <span class="s2">&quot;LF_HF&quot;</span><span class="p">,</span> <span class="s2">&quot;LF_n&quot;</span><span class="p">,</span> <span class="s2">&quot;HF_n&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hrv_ann_detailed_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;nsrrid&quot;</span><span class="p">,</span> <span class="s2">&quot;visitnumber&quot;</span><span class="p">,</span> <span class="s2">&quot;Start__sec_&quot;</span><span class="p">,</span> <span class="s2">&quot;ihr&quot;</span><span class="p">,</span> <span class="s2">&quot;hasrespevent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NN_RR&quot;</span><span class="p">,</span> <span class="s2">&quot;AVNN&quot;</span><span class="p">,</span> <span class="s2">&quot;SDNN&quot;</span><span class="p">,</span> <span class="s2">&quot;rMSSD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PNN10&quot;</span><span class="p">,</span> <span class="s2">&quot;PNN20&quot;</span><span class="p">,</span> <span class="s2">&quot;PNN30&quot;</span><span class="p">,</span> <span class="s2">&quot;PNN40&quot;</span><span class="p">,</span> <span class="s2">&quot;PNN50&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TOT_PWR&quot;</span><span class="p">,</span> <span class="s2">&quot;VLF&quot;</span><span class="p">,</span> <span class="s2">&quot;LF&quot;</span><span class="p">,</span> <span class="s2">&quot;LF_n&quot;</span><span class="p">,</span> <span class="s2">&quot;HF&quot;</span><span class="p">,</span> <span class="s2">&quot;HF_n&quot;</span><span class="p">,</span> <span class="s2">&quot;LF_HF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sleepstage01&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage02&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage03&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage04&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage05&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sleepstage06&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage07&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage08&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage09&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage10&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event01start&quot;</span><span class="p">,</span> <span class="s2">&quot;event01end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event02start&quot;</span><span class="p">,</span> <span class="s2">&quot;event02end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event03start&quot;</span><span class="p">,</span> <span class="s2">&quot;event03end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event04start&quot;</span><span class="p">,</span> <span class="s2">&quot;event04end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event05start&quot;</span><span class="p">,</span> <span class="s2">&quot;event05end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event06start&quot;</span><span class="p">,</span> <span class="s2">&quot;event06end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event07start&quot;</span><span class="p">,</span> <span class="s2">&quot;event07end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event08start&quot;</span><span class="p">,</span> <span class="s2">&quot;event08end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event09start&quot;</span><span class="p">,</span> <span class="s2">&quot;event09end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event10start&quot;</span><span class="p">,</span> <span class="s2">&quot;event10end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event11start&quot;</span><span class="p">,</span> <span class="s2">&quot;event11end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event12start&quot;</span><span class="p">,</span> <span class="s2">&quot;event12end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event13start&quot;</span><span class="p">,</span> <span class="s2">&quot;event13end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event14start&quot;</span><span class="p">,</span> <span class="s2">&quot;event14end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event15start&quot;</span><span class="p">,</span> <span class="s2">&quot;event15end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event16start&quot;</span><span class="p">,</span> <span class="s2">&quot;event16end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event17start&quot;</span><span class="p">,</span> <span class="s2">&quot;event17end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event18start&quot;</span><span class="p">,</span> <span class="s2">&quot;event18end&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hrv_ann_epoch_len_sec</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># 5min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_ann_keys_from_hrv</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Start__sec_&quot;</span><span class="p">,</span> <span class="s2">&quot;hasrespevent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sleepstage01&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage02&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage03&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage04&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage05&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sleepstage06&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage07&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage08&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage09&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage10&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event01start&quot;</span><span class="p">,</span> <span class="s2">&quot;event01end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event02start&quot;</span><span class="p">,</span> <span class="s2">&quot;event02end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event03start&quot;</span><span class="p">,</span> <span class="s2">&quot;event03end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event04start&quot;</span><span class="p">,</span> <span class="s2">&quot;event04end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event05start&quot;</span><span class="p">,</span> <span class="s2">&quot;event05end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event06start&quot;</span><span class="p">,</span> <span class="s2">&quot;event06end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event07start&quot;</span><span class="p">,</span> <span class="s2">&quot;event07end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event08start&quot;</span><span class="p">,</span> <span class="s2">&quot;event08end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event09start&quot;</span><span class="p">,</span> <span class="s2">&quot;event09end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event10start&quot;</span><span class="p">,</span> <span class="s2">&quot;event10end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event11start&quot;</span><span class="p">,</span> <span class="s2">&quot;event11end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event12start&quot;</span><span class="p">,</span> <span class="s2">&quot;event12end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event13start&quot;</span><span class="p">,</span> <span class="s2">&quot;event13end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event14start&quot;</span><span class="p">,</span> <span class="s2">&quot;event14end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event15start&quot;</span><span class="p">,</span> <span class="s2">&quot;event15end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event16start&quot;</span><span class="p">,</span> <span class="s2">&quot;event16end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event17start&quot;</span><span class="p">,</span> <span class="s2">&quot;event17end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event18start&quot;</span><span class="p">,</span> <span class="s2">&quot;event18end&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_ann_keys_from_hrv</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Start__sec_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sleepstage01&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage02&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage03&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage04&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage05&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sleepstage06&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage07&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage08&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage09&quot;</span><span class="p">,</span> <span class="s2">&quot;sleepstage10&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_event_ann_keys_from_hrv</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Start__sec_&quot;</span><span class="p">,</span> <span class="s2">&quot;hasrespevent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event01start&quot;</span><span class="p">,</span> <span class="s2">&quot;event01end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event02start&quot;</span><span class="p">,</span> <span class="s2">&quot;event02end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event03start&quot;</span><span class="p">,</span> <span class="s2">&quot;event03end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event04start&quot;</span><span class="p">,</span> <span class="s2">&quot;event04end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event05start&quot;</span><span class="p">,</span> <span class="s2">&quot;event05end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event06start&quot;</span><span class="p">,</span> <span class="s2">&quot;event06end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event07start&quot;</span><span class="p">,</span> <span class="s2">&quot;event07end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event08start&quot;</span><span class="p">,</span> <span class="s2">&quot;event08end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event09start&quot;</span><span class="p">,</span> <span class="s2">&quot;event09end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event10start&quot;</span><span class="p">,</span> <span class="s2">&quot;event10end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event11start&quot;</span><span class="p">,</span> <span class="s2">&quot;event11end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event12start&quot;</span><span class="p">,</span> <span class="s2">&quot;event12end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event13start&quot;</span><span class="p">,</span> <span class="s2">&quot;event13end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event14start&quot;</span><span class="p">,</span> <span class="s2">&quot;event14end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event15start&quot;</span><span class="p">,</span> <span class="s2">&quot;event15end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event16start&quot;</span><span class="p">,</span> <span class="s2">&quot;event16end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event17start&quot;</span><span class="p">,</span> <span class="s2">&quot;event17end&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event18start&quot;</span><span class="p">,</span> <span class="s2">&quot;event18end&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># annotations from events-nsrr and events-profusion folders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;EventType&quot;</span><span class="p">,</span> <span class="s2">&quot;EventConcept&quot;</span><span class="p">,</span> <span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;Duration&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SignalLocation&quot;</span><span class="p">,</span> <span class="s2">&quot;SpO2Nadir&quot;</span><span class="p">,</span> <span class="s2">&quot;SpO2Baseline&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="c1"># NOTE: the union of names from shhs1-200001 to shhs1-200399</span>
        <span class="c1"># NOT a full search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_event_types_from_event</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Respiratory&quot;</span><span class="p">,</span> <span class="s2">&quot;Stages&quot;</span><span class="p">,</span> <span class="s2">&quot;Arousals&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">long_event_types_from_event</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Respiratory|Respiratory&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Stages|Stages&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Arousals|Arousals&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="c1"># NOTE: the union of names from shhs1-200001 to shhs1-200399</span>
        <span class="c1"># NOT a full search</span>
        <span class="c1"># NOT including sleep stages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_event_names_from_event</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Central Apnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Obstructive Apnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Mixed Apnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Hypopnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SpO2 artifact&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SpO2 desaturation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Arousal ()&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Arousal (Standard)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Arousal (STANDARD)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Arousal (CHESHIRE)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Arousal (ASDA)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Unsure&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">long_event_names_from_event</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Central apnea|Central Apnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Obstructive apnea|Obstructive Apnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Mixed apnea|Mixed Apnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Hypopnea|Hypopnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SpO2 artifact|SpO2 artifact&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SpO2 desaturation|SpO2 desaturation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Arousal|Arousal ()&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Arousal|Arousal (Standard)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Arousal|Arousal (STANDARD)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Arousal resulting from Chin EMG|Arousal (CHESHIRE)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ASDA arousal|Arousal (ASDA)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Unsure|Unsure&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_profusion_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;Duration&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Input&quot;</span><span class="p">,</span> <span class="s2">&quot;LowestSpO2&quot;</span><span class="p">,</span> <span class="s2">&quot;Desaturation&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="c1"># NOTE: currently the union of names from shhs1-200001 to shhs1-200099,</span>
        <span class="c1"># NOT a full search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_names_from_event_profusion</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Central Apnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Obstructive Apnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Mixed Apnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Hypopnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SpO2 artifact&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SpO2 desaturation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Arousal ()&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Arousal (ASDA)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Unsure&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apnea_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Central Apnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Obstructive Apnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Mixed Apnea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Hypopnea&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># annotations regarding wave delineation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave_deli_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;RPoint&quot;</span><span class="p">,</span> <span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;End&quot;</span><span class="p">,</span>
            <span class="s2">&quot;STLevel1&quot;</span><span class="p">,</span> <span class="s2">&quot;STSlope1&quot;</span><span class="p">,</span> <span class="s2">&quot;STLevel2&quot;</span><span class="p">,</span> <span class="s2">&quot;STSlope2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Manual&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;rpointadj&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PPoint&quot;</span><span class="p">,</span> <span class="s2">&quot;PStart&quot;</span><span class="p">,</span> <span class="s2">&quot;PEnd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TPoint&quot;</span><span class="p">,</span> <span class="s2">&quot;TStart&quot;</span><span class="p">,</span> <span class="s2">&quot;TEnd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TemplateID&quot;</span><span class="p">,</span> <span class="s2">&quot;nsrrid&quot;</span><span class="p">,</span> <span class="s2">&quot;samplingrate&quot;</span><span class="p">,</span> <span class="s2">&quot;seconds&quot;</span><span class="p">,</span> <span class="s2">&quot;epoch&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave_deli_samp_num_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;RPoint&quot;</span><span class="p">,</span> <span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;End&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PPoint&quot;</span><span class="p">,</span> <span class="s2">&quot;PStart&quot;</span><span class="p">,</span> <span class="s2">&quot;PEnd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TPoint&quot;</span><span class="p">,</span> <span class="s2">&quot;TStart&quot;</span><span class="p">,</span> <span class="s2">&quot;TEnd&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># TODO: other annotation files: EEG</span>

        <span class="c1"># self-defined items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;start_sec&quot;</span><span class="p">,</span> <span class="s2">&quot;sleep_stage&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_event_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;event_name&quot;</span><span class="p">,</span> <span class="s2">&quot;event_start&quot;</span><span class="p">,</span> <span class="s2">&quot;event_end&quot;</span><span class="p">,</span> <span class="s2">&quot;event_duration&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_epoch_len_sec</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ann_sleep_stages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        0 --- Wake</span>
<span class="sd">        1 --- sleep stage 1</span>
<span class="sd">        2 --- sleep stage 2</span>
<span class="sd">        3 --- sleep stage 3/4</span>
<span class="sd">        4 --- sleep stage 3/4</span>
<span class="sd">        5 --- REM stage</span>
<span class="sd">        9 --- Movement/Wake or Unscored?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_protocol</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sleep_stage_protocol&quot;</span><span class="p">,</span> <span class="s2">&quot;aasm&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_sleep_stage_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;N1&quot;</span><span class="p">,</span> <span class="s2">&quot;N2&quot;</span><span class="p">,</span> <span class="s2">&quot;N3&quot;</span><span class="p">,</span> <span class="s2">&quot;N4&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_name_value_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;N1&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;N2&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s2">&quot;N3&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s2">&quot;N4&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_stage_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sleep_stage_names</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_simplified_states</span> <span class="o">=</span> <span class="p">{</span><span class="mi">9</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        9 to nan?</span>
<span class="sd">        0 --- awake</span>
<span class="sd">        1 --- REM</span>
<span class="sd">        2 --- N1 (NREM1/2), shallow sleep</span>
<span class="sd">        3 --- N2 (NREM3/4), deep sleep</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_aasm_states</span> <span class="o">=</span> <span class="p">{</span><span class="mi">9</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        9 to nan?</span>
<span class="sd">        0 --- awake</span>
<span class="sd">        1 --- REM</span>
<span class="sd">        2 --- N1 (NREM1)</span>
<span class="sd">        3 --- N2 (NREM2)</span>
<span class="sd">        4 --- N3 (NREM3/4)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_shhs_states</span> <span class="o">=</span> <span class="p">{</span><span class="mi">9</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>

        <span class="c1"># for plotting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
            <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;N1&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
            <span class="s2">&quot;N2&quot;</span><span class="p">:</span> <span class="s2">&quot;cyan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;N3&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
            <span class="s2">&quot;N4&quot;</span><span class="p">:</span> <span class="s2">&quot;purple&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Central Apnea&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Obstructive Apnea&quot;</span><span class="p">:</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Mixed Apnea&quot;</span><span class="p">:</span> <span class="s2">&quot;cyan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Hypopnea&quot;</span><span class="p">:</span> <span class="s2">&quot;purple&quot;</span><span class="p">,</span>
        <span class="p">}</span>  <span class="c1"># TODO: add more</span>

        <span class="c1"># fmt: on</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">folder_or_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;psg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">psg_data_path</span><span class="p">,</span>
            <span class="s2">&quot;wave_delineation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_deli_path</span><span class="p">,</span>
            <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_ann_path</span><span class="p">,</span>
            <span class="s2">&quot;event_profusion&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_profusion_ann_path</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;one has to apply for a token from `sleepdata.org` &quot;</span> <span class="s2">&quot;and uses `nsrr` to download the data&quot;</span><span class="p">,</span>
            <span class="ne">RuntimeWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">database_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataBaseInfo</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_SHHS_INFO</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2021, WEN Hao, KANG Jingsu.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>